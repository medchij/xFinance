{"version":3,"file":"page-tools.js","mappings":"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","sources":["webpack://xfinance/./src/XFinance/externalAPI.js","webpack://xfinance/./src/XFinance/polaris.js","webpack://xfinance/./src/XFinance/components/CreateGL.jsx","webpack://xfinance/./src/XFinance/components/CreateAccount.jsx","webpack://xfinance/./src/XFinance/components/CustomerModal.jsx","webpack://xfinance/./src/XFinance/components/LogPanel.jsx","webpack://xfinance/./src/XFinance/components/CalendarDateBoundaries.jsx","webpack://xfinance/./src/icons.jsx","webpack://xfinance/./src/XFinance/components/SearchTableSheet.jsx","webpack://xfinance/./src/XFinance/components/CustomTools.jsx","webpack://xfinance/./src/XFinance/ebarimt.js"],"sourcesContent":["import {\r\n  withLoading,\r\n  loadSettings,\r\n  getSettingValue,\r\n  getSettingId,\r\n  normalizeExcelDate,\r\n  formatLargeNumber,\r\n  handleHttpError,\r\n  saveSetting,\r\n} from \"./apiHelpers\";\r\nimport { BASE_URL } from \"../config\";\r\nexport async function fetchCurrencyRatesByAPI(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    setMessage(\"⏳ Ханшийн мэдээлэл татаж байна...\");\r\n\r\n    const { startDate, endDate } = await Excel.run(async (context) => {\r\n      const range = context.workbook.getActiveCell();\r\n      range.load(\"values\");\r\n      await context.sync();\r\n\r\n      let value = range.values[0][0];\r\n\r\n      if (!value || (typeof value !== \"number\" && typeof value !== \"string\")) {\r\n        throw new Error(\"📅 Идэвхтэй нүдэнд огноо оруулна уу (2025-01-30 эсвэл Excel огнооны format)\");\r\n      }\r\n\r\n      if (typeof value === \"number\") {\r\n        const excelEpoch = new Date(1899, 11, 30); // Excel date base\r\n        const dateObj = new Date(excelEpoch.getTime() + value * 86400000);\r\n        value = dateObj.toISOString().split(\"T\")[0];\r\n      }\r\n\r\n      if (typeof value === \"string\" && !/^\\d{4}-\\d{2}-\\d{2}$/.test(value)) {\r\n        throw new Error(\"📅 Огнооны формат буруу байна. YYYY-MM-DD хэлбэртэй байвал зохимжтой.\");\r\n      }\r\n\r\n      return {\r\n        startDate: value,\r\n        endDate: value,\r\n      };\r\n    });\r\n\r\n    setMessage(`📅 Огноо: ${startDate} - ${endDate}`);\r\n\r\n    const response = await fetch(\r\n      `https://www.mongolbank.mn/mn/currency-rates/data?startDate=${startDate}&endDate=${endDate}`,\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n\r\n    if (!response.ok) {\r\n      handleHttpError(response, result);\r\n    }\r\n    // console.log(\"🌐 Server-ээс ирсэн result:\", result);\r\n\r\n    if (!result || !Array.isArray(result.data)) {\r\n      throw new Error(\"Буцаж ирсэн дата дотор Array байхгүй байна.\");\r\n    }\r\n\r\n    await Excel.run(async (context) => {\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n      sheet.load(\"name\");\r\n      await context.sync();\r\n\r\n      if (sheet.name.toLowerCase() !== \"rate\") {\r\n        throw new Error(\"⚠️ Энэ функц зөвхөн 'rate' нэртэй sheet дээр ажиллана.\");\r\n      }\r\n\r\n      const startCell = context.workbook.getActiveCell();\r\n      startCell.load([\"rowIndex\", \"columnIndex\"]);\r\n      await context.sync();\r\n\r\n      const row = startCell.rowIndex;\r\n      const col = startCell.columnIndex;\r\n\r\n      const dayItem = result.data[0]; // assume one date\r\n      const usdRate = dayItem[\"USD\"];\r\n      const jpyRate = dayItem[\"JPY\"];\r\n      const rateDate = new Date(dayItem[\"RATE_DATE\"]).toISOString().split(\"T\")[0];\r\n\r\n      if (!usdRate || !jpyRate || !rateDate) {\r\n        throw new Error(\"USD эсвэл JPY ханш олдсонгүй.\");\r\n      }\r\n\r\n      // ✅ Ханшийн утгыг sheet рүү бичнэ\r\n      sheet.getCell(row, col + 2).values = \"1\";\r\n      sheet.getCell(row, col + 3).values = [[usdRate]];\r\n      sheet.getCell(row, col + 4).values = [[jpyRate]];\r\n\r\n      await context.sync();\r\n      setMessage(`✅ ${rateDate} өдрийн USD болон JPY ханш амжилттай бичигдлээ.`);\r\n    });\r\n    return { result, response };\r\n  });\r\n}\r\n\r\nasync function getCarToken() {\r\n  const response = await fetch(\"https://service.transdep.mn/autobox-backend/api/v1/user/login\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  });\r\n\r\n  const result = await response.json();\r\n  if (!response.ok || !result.token) {\r\n    throw new Error(\"❌ Token авахад алдаа гарлаа: \" + (result.status?.message || \"Алдаа гарлаа.\"));\r\n  }\r\n  return result.token;\r\n}\r\n\r\nexport async function fetchVehicleInfoByPlate(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    setMessage(\"⏳ Машины мэдээлэл татаж байна...\");\r\n\r\n    let settings = await loadSettings();\r\n    let car_token = getSettingValue(settings, \"car_token\");\r\n\r\n    const plateNo = await Excel.run(async (context) => {\r\n      const range = context.workbook.getActiveCell();\r\n      range.load(\"values\");\r\n      await context.sync();\r\n\r\n      const value = range.values[0][0];\r\n      if (!value || typeof value !== \"string\") {\r\n        throw new Error(\"📄 Идэвхтэй нүдэнд машины дугаар бичнэ үү.\");\r\n      }\r\n      return value.trim().replace(/-/g, \"\");\r\n    });\r\n\r\n    async function fetchVehicleData(token) {\r\n      const response = await fetch(\"https://service.transdep.mn/autobox-backend/api/v1/vehicle/data\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ plate_no: plateNo }),\r\n      });\r\n      const result = await response.json();\r\n      return { response, result };\r\n    }\r\n\r\n    // 🟡 Token-оор хүсэлт илгээх\r\n    let { response, result } = await fetchVehicleData(car_token);\r\n\r\n    // 🔁 Хэрвээ token хугацаа дууссан бол дахин token авч fetch хийх\r\n    if (response.status === 401) {\r\n      car_token = await getCarToken();\r\n      await saveSetting(\"car_token\", car_token); // ⚠️ saveSetting ашиглаж шинэ token хадгалах\r\n\r\n      ({ response, result } = await fetchVehicleData(car_token));\r\n    }\r\n\r\n    if (!response.ok) {\r\n      handleHttpError(response, result);\r\n    }\r\n\r\n    const data = result.data;\r\n    if (!data) {\r\n      throw new Error(\"⚠️ Машины 'data' мэдээлэл хоосон байна.\");\r\n    }\r\n\r\n    const fieldsToShow = [\r\n      \"cabin_no\", \"declaration_no\", \"mark_name\", \"build_year\", \"build_month\", \"imported_date\",\r\n      \"color_name\", \"country_name\", \"model_name\", \"purpose_name\", \"fuel_type_eco_class_name\",\r\n      \"fuel_type_name\", \"steering_type_name\", \"vehicle_type_name\", \"wheel_name\",\r\n      \"owner.first_name\", \"owner.register\",\r\n    ];\r\n\r\n    const popupContent = fieldsToShow\r\n      .map((key) => {\r\n        if (key.includes(\".\")) {\r\n          const value = key.split(\".\").reduce((acc, part) => acc?.[part], data);\r\n          return `${key}: ${value ?? \"\"}`;\r\n        } else {\r\n          return `${key}: ${data[key] ?? \"\"}`;\r\n        }\r\n      })\r\n      .join(\"<br>\");\r\n\r\n    setMessage(`⚠️ Машины мэдээлэл:<br>${popupContent}`);\r\n    return { response, result, data };\r\n  });\r\n}\r\n\r\nexport async function fetchKhanbankReceiptFromSheet(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    setMessage(\"⏳ Хуулга татаж байна...\");\r\n\r\n    // ✅ Settings.json-оос token авах\r\n    const settings = await loadSettings();\r\n    const token = getSettingValue(settings, \"access_token\");\r\n\r\n    const { accountNo, fromDate, toDate } = await Excel.run(async (context) => {\r\n      const sheet = context.workbook.worksheets.getItem(\"Import\");\r\n      const range = sheet.getRange(\"B3:B5\");\r\n      range.load(\"values\");\r\n      await context.sync();\r\n\r\n      const [acc, fromRaw, toRaw] = range.values.map((r) => r[0]);\r\n\r\n      if (!token || !acc || !fromRaw || !toRaw) {\r\n        throw new Error(\"📌 B2-B5 нүднүүдэд token, accountNo, fromDate, toDate бүгд байх шаардлагатай!\");\r\n      }\r\n\r\n      return {\r\n        accountNo: acc.toString().trim(),\r\n        fromDate: normalizeExcelDate(fromRaw + 1, \"fromDate\"),\r\n        toDate: normalizeExcelDate(toRaw + 1, \"toDate\"),\r\n      };\r\n    });\r\n\r\n    const myHeaders = new Headers();\r\n    myHeaders.append(\"Authorization\", `Bearer ${token}`);\r\n    myHeaders.append(\"Referer\", \"https://corp.khanbank.com\");\r\n    myHeaders.append(\"Origin\", \"https://corp.khanbank.com\");\r\n    myHeaders.append(\"Host\", \"api.khanbank.com:9003\");\r\n\r\n    const url = `https://api.khanbank.com:9003/v3/omni/accounts/receipt/${accountNo}?transactionDate=%7B%22lt%22:%22${fromDate}T17:42:30%22,%22gt%22:%22${toDate}T09:57:20%22%7D&docType=0&transactionAmount=%7B%22gt%22:%220%22,%22lt%22:%220%22%7D`;\r\n    //console.log(\"🔗 URL:\", url);\r\n    const response = await fetch(url, {\r\n      method: \"GET\",\r\n      headers: myHeaders,\r\n      redirect: \"follow\",\r\n    });\r\n    //     for (const [key, value] of myHeaders.entries()) {\r\n    //   console.log(`${key}: ${value}`);\r\n    // }\r\n\r\n    const result = await response.json();\r\n    //console.log(\"📄 Хуулга дата:\", result);\r\n\r\n    if (!response.ok) {\r\n      handleHttpError(response, result);\r\n    }\r\n\r\n    const transactions = result.transactions.map((tx) => ({\r\n      transactionDate: `${tx.transactionDate} ${tx.txnTime || \"\"}`, // ✅ transactionDate + txnTime\r\n      txnBranchId: tx.txnBranchId,\r\n      beginBalance: tx.beginBalance.amount,\r\n      Debit: tx.amountType.codeDescription === \"Debit\" ? tx.amount.amount : \"\",\r\n      Credit: tx.amountType.codeDescription === \"Credit\" ? tx.amount.amount : \"\",\r\n      endBalance: tx.endBalance.amount,\r\n      transactionRemarks: tx.transactionRemarks,\r\n      accountId: formatLargeNumber(tx.accountId),\r\n    }));\r\n\r\n    await Excel.run(async (context) => {\r\n      const sheet = context.workbook.worksheets.getItem(\"Import\");\r\n\r\n      const headers = [\r\n        \"transactionDate\",\r\n        \"txnBranchId\",\r\n        \"beginBalance\",\r\n        \"Debit\",\r\n        \"Credit\",\r\n        \"endBalance\",\r\n        \"transactionRemarks\",\r\n        \"accountId\",\r\n      ];\r\n\r\n      const rows = transactions.map((tx) => [\r\n        tx.transactionDate,\r\n        tx.txnBranchId,\r\n        tx.beginBalance,\r\n        tx.Debit,\r\n        tx.Credit,\r\n        tx.endBalance,\r\n        tx.transactionRemarks,\r\n        tx.accountId,\r\n      ]);\r\n\r\n      // Header бичих\r\n      const headerRange = sheet.getRange(\"A8:H8\");\r\n      headerRange.values = [headers];\r\n\r\n      // Data бичих\r\n      const dataRange = sheet.getRangeByIndexes(8, 0, rows.length, headers.length);\r\n      dataRange.values = rows;\r\n\r\n      await context.sync();\r\n    });\r\n\r\n    setMessage(\"✅ Хуулга амжилттай татагдаж, Excel-д бичигдлээ.\");\r\n    return { result, response };\r\n  });\r\n}\r\n//Туслах функц: Khanbank token авах\r\nexport async function getKhanbankToken(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    setMessage(\"🔐 Access token авч байна...\");\r\n\r\n    const settings = await loadSettings();\r\n    const username = getSettingValue(settings, \"khanbank_username\");\r\n    const password = getSettingValue(settings, \"khanbank_password\");\r\n    const deviceToken = getSettingValue(settings, \"device_token\");\r\n    const deviceId = getSettingValue(settings, \"device-id\");\r\n    const accessId = getSettingId(settings, \"access_token\");\r\n    const refreshId = getSettingId(settings, \"refresh_token\");\r\n\r\n    if (!username || !password || !deviceToken || !accessId || !refreshId || !deviceId) {\r\n      throw new Error(\"⚠️ Settings.json дээр шаардлагатай мэдээлэл дутуу байна\");\r\n    }\r\n\r\n    // ✅ Headers-ийг myHeaders.append хэлбэрээр бичих\r\n    const myHeaders = new Headers();\r\n    myHeaders.append(\"Origin\", \"https://corp.khanbank.com\");\r\n    myHeaders.append(\"Referer\", \"https://corp.khanbank.com/\");\r\n    myHeaders.append(\"Host\", \"api.khanbank.com:9003\");\r\n    myHeaders.append(\"Authorization\", deviceToken);\r\n    myHeaders.append(\"Device-id\", deviceId);\r\n    myHeaders.append(\"Content-Type\", \"application/json\");\r\n    myHeaders.append(\r\n      \"Cookie\",\r\n      \"__uzma=20418a7f-ce91-e5c8-6225-bc7b412e9039; __uzmb=1747732417; __uzmc=5803638828705; __uzmd=1747962735; __uzme=0783\"\r\n    );\r\n\r\n    const body = JSON.stringify({\r\n      grant_type: \"password\",\r\n      username,\r\n      password,\r\n      channelId: \"I\",\r\n    });\r\n\r\n    const response = await fetch(\"https://api.khanbank.com:9003/v3/auth/token?grant_type=password\", {\r\n      method: \"POST\",\r\n      headers: myHeaders,\r\n      body,\r\n      redirect: \"follow\",\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    //console.log(\"🔑 Token хариу:\", result);\r\n\r\n    if (!response.ok) {\r\n      handleHttpError(response, result);\r\n    }\r\n\r\n    setMessage(\"✅ Token амжилттай авлаа.\");\r\n\r\n    // ✅ Token-уудыг хадгалах\r\n    // await Excel.run(async (context) => {\r\n    //   const sheet = context.workbook.worksheets.getItem(\"Import\");\r\n    //   sheet.getRange(\"B2\").values = [[result.access_token ?? \"\"]];\r\n    // });\r\n\r\n    await fetch(`${BASE_URL}/api/settings/${accessId}`, {\r\n      method: \"PUT\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ value: result.access_token }),\r\n    });\r\n\r\n    await fetch(`${BASE_URL}/api/settings/${refreshId}`, {\r\n      method: \"PUT\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ value: result.refresh_token }),\r\n    });\r\n\r\n    return { result, response };\r\n  });\r\n}\r\n\r\n\r\nexport async function fetchKhanbankAccountInfo(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    setMessage(\"⏳ Данс лавлаж байна...\");\r\n\r\n    const settings = await loadSettings();\r\n    let token = getSettingValue(settings, \"access_token\");\r\n\r\n    const { accountNo, activeCellAddress } = await Excel.run(async (context) => {\r\n      const activeCell = context.workbook.getActiveCell();\r\n      activeCell.load(\"values, address\");\r\n      await context.sync();\r\n\r\n      const acc = activeCell.values[0][0];\r\n      if (!token || !acc) {\r\n        throw new Error(\"📌 Идэвхтэй нүдэнд accountNo байх шаардлагатай!\");\r\n      }\r\n\r\n      return {\r\n        accountNo: acc.toString().trim(),\r\n        activeCellAddress: activeCell.address,\r\n      };\r\n    });\r\n\r\n    const isIban = /^MN[a-zA-Z0-9]{16,}$/.test(accountNo);\r\n    const apiPath = isIban\r\n      ? `https://api.khanbank.com:9003/v3/omni/accounts/inquiry/${accountNo}`\r\n      : `https://api.khanbank.com:9003/v3/omni/corp/custom/counterparties/accDetails/${accountNo}`;\r\n\r\n    const makeRequest = async (access_token) => {\r\n      const headers = new Headers();\r\n      headers.append(\"Authorization\", `Bearer ${access_token}`);\r\n      headers.append(\"Referer\", \"https://corp.khanbank.com\");\r\n      headers.append(\"Origin\", \"https://corp.khanbank.com\");\r\n      headers.append(\"Host\", \"api.khanbank.com:9003\");\r\n   \r\n\r\n      const response = await fetch(apiPath, {\r\n        method: \"GET\",\r\n        headers,\r\n        redirect: \"follow\",\r\n      });\r\n\r\n      const result = await response.json();\r\n      return { response, result };\r\n    };\r\n\r\n    let { response, result } = await makeRequest(token);\r\n\r\n    if (response.status === 401) {\r\n      // 🟡 Token хугацаа дууссан — шинэ token авна\r\n      const tokenResp = await getKhanbankToken(setMessage, setLoading);\r\n      token = tokenResp.result.access_token;\r\n\r\n      // дахин хүсэлт хийнэ\r\n      ({ response, result } = await makeRequest(token));\r\n    }\r\n\r\n    if (!response.ok) {\r\n      handleHttpError(response, result);\r\n    }\r\n\r\n    const accountDetail = isIban ? result?.name || \"\" : result?.counterpartyName || \"\";\r\n\r\n    await Excel.run(async (context) => {\r\n      const range = context.workbook.getActiveCell();\r\n      const rightCell = range.getOffsetRange(0, 1);\r\n      rightCell.values = [[accountDetail]];\r\n      await context.sync();\r\n    });\r\n    console.log(\"✅ Дансны мэдээлэл:\", result);\r\n    setMessage(\"✅ Данс лавлагдаж, баруун нүдэнд бичигдлээ.\");\r\n    return { result, response, accountDetail, activeCellAddress };\r\n  });\r\n}\r\n\r\n","// ✅ Loan Report Processor - Converted from VBA to Office.js (Excel JavaScript API)\r\n// ⚠️ Note: Complex calculations like SUMIFS/COUNTIFS are replaced with manual filtering and aggregation\r\nimport { loadSettings, getSettingValue, withLoading, hideEmptyColumns } from \"./apiHelpers\";\r\nimport { lastImportedData } from \"./xFinance\";\r\nexport const writeFromImportedSameColumn = async ({\r\n  setLoading,\r\n  showMessage,\r\n  settingKey = \"PD_ALL\",\r\n  caseSensitive = false,\r\n}) => {\r\n  try {\r\n    await withLoading(setLoading, showMessage, async () => {\r\n      // ⚙️ PD_ALL -> targetColIndex\r\n      const settings = await loadSettings();\r\n      const targetColNumber = parseInt(getSettingValue(settings, settingKey), 10);\r\n      if (!Number.isInteger(targetColNumber) || targetColNumber < 1) {\r\n        throw new Error(`⚠️ Тохиргоо '${settingKey}' буруу байна (эерэг бүхэл тоо).`);\r\n      }\r\n      const targetColIndex = targetColNumber - 1;\r\n\r\n      // 🧩 Импорт өгөгдөл шалгах\r\n      if (!Array.isArray(lastImportedData) || lastImportedData.length === 0) {\r\n        throw new Error(\"⚠️ Импортын дата олдсонгүй. Эхлээд файл импортоороо уншуулна уу.\");\r\n      }\r\n\r\n      await Excel.run(async (context) => {\r\n        const wb = context.workbook;\r\n        const activeCell = wb.getActiveCell();\r\n        activeCell.load([\"rowIndex\", \"columnIndex\", \"values\"]);\r\n        await context.sync();\r\n\r\n        const activeRow = activeCell.rowIndex;\r\n        const activeCol = activeCell.columnIndex;\r\n        const rawKey = (activeCell.values?.[0]?.[0] ?? \"\").toString().trim();\r\n        if (!rawKey) throw new Error(\"⚠️ Идэвхтэй нүд хоосон байна.\");\r\n\r\n        // 🔎 Ижил БАГАНА (activeCol) дээр түлхүүр тааруулах\r\n        const norm = (v) => (v ?? \"\").toString().trim();\r\n        const keyCmp = caseSensitive ? rawKey : rawKey.toLowerCase();\r\n\r\n        let matchRowIndex = -1;\r\n        for (let r = 0; r < lastImportedData.length; r++) {\r\n          const cell = norm(lastImportedData[r]?.[activeCol]);\r\n          const cmp = caseSensitive ? cell : cell.toLowerCase();\r\n          if (cmp === keyCmp) { matchRowIndex = r; break; }\r\n        }\r\n        if (matchRowIndex === -1) {\r\n          throw new Error(`⚠️ Импортын массивын ${activeCol + 1}-р баганад \"${rawKey}\" олдсонгүй.`);\r\n        }\r\n\r\n        // 📤 Олдсон мөрийн PD_ALL баганын утгыг баруун талд бичих\r\n        const valueToWrite = lastImportedData[matchRowIndex]?.[targetColIndex] ?? \"\";\r\n        const sheet = wb.worksheets.getActiveWorksheet();\r\n        sheet.getCell(activeRow, activeCol + 1).values = [[valueToWrite]];\r\n        await context.sync();\r\n      });\r\n\r\n      showMessage?.(\"✅ Импортын массивтай амжилттай тааруулж, баруун талд бичлээ.\");\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    showMessage?.(`❌ Алдаа: ${err?.message || err}`);\r\n  }\r\n};\r\n\r\n\r\n\r\nexport function getTermInterval(daysOrMonths) {\r\n  const days = Number(daysOrMonths);\r\n  if (isNaN(days)) return \"\";\r\n\r\n  if (days <= 0) return \"Хугацаагүй\";\r\n  if (days <= 30) return \"1 сар хүртэл хугацаатай\";\r\n  if (days <= 90) return \"1-3 сар хүртэл хугацаатай\";\r\n  if (days <= 180) return \"3-6 сар хүртэл хугацаатай\";\r\n  if (days <= 365) return \"6-12 сар хүртэл хугацаатай\";\r\n  if (days <= 1095) return \"12-36 сар хүртэл хугацаатай\";\r\n  if (days <= 1825) return \"36-60 сар хүртэл хугацаатай\";\r\n  return \"60-с дээш сар хүртэл хугацаатай\";\r\n}\r\n\r\nexport function writeHeaders(sheet, rowIndex, headersArray, startCol = 0) {\r\n  headersArray.forEach((text, idx) => {\r\n    sheet.getCell(rowIndex, startCol + idx).values = [[text]];\r\n  });\r\n}\r\n//Зээлийн баланс тайлан боловсруулалт\r\n\r\nexport async function runLoanReportProcessor(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    await Excel.run(async (context) => {\r\n      setMessage(\"⏳ Ажиллаж байна...\");\r\n\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n      const c1Cell = sheet.getCell(0, 2); // C1\r\n      c1Cell.load(\"values\");\r\n      await context.sync();\r\n\r\n      const c1Value = c1Cell.values[0][0];\r\n      if (!c1Value || !c1Value.toString().includes(\"ЗЭЭЛИЙН ҮЛДЭГДЛИЙН ДЭЛГЭРЭНГҮЙ ТАЙЛАН\")) {\r\n        throw new Error(\"⚠️ ⚠️ Энэ хуудас ЗЭЭЛИЙН ҮЛДЭГДЛИЙН ДЭЛГЭРЭНГҮЙ ТАЙЛАН биш байна..\");\r\n      }\r\n\r\n      const lastRow = await getLastRow(sheet, 0); // A баганын дагуу\r\n\r\n      // Толгойн багана бичих\r\n      writeHeaders(sheet, 4, [\"HUGATSAANII INTERVAL\", \"SEGMENT1\", \"ANGILAL1\", \"BUTEEGDEHUUN1\"], 54);\r\n      await context.sync();\r\n\r\n      const headers = await getHeaderMap(sheet);\r\n\r\n      // B3-г урьдчилж татах\r\n      const b3Cell = sheet.getCell(2, 1); // B3\r\n      b3Cell.load(\"values\");\r\n      await context.sync();\r\n      const dateFromCell = new Date(Date.parse(b3Cell.values[0][0].toString().substring(9)));\r\n\r\n      // Бүх мөрийг нэг дор татах\r\n      const dataRange = sheet.getRangeByIndexes(5, 0, lastRow - 5, 55);\r\n      dataRange.load(\"values\");\r\n      await context.sync();\r\n      const rows = dataRange.values;\r\n\r\n      // Бичих массивууд\r\n      const segData = [],\r\n        angilalData = [],\r\n        buteeData = [],\r\n        intervalData = [];\r\n\r\n      for (let i = 0; i < rows.length; i++) {\r\n        const row = rows[i];\r\n        const segCode = row[headers[\"СЕГМЕНТ\"]]?.toString().substring(0, 2);\r\n        const zoriulalt = row[headers[\"ЗОРИУЛАЛТ\"]]?.toString().substring(0, 2);\r\n        const angilal = row[headers[\"АНГИЛАЛ\"]]\r\n          ?.toString()\r\n          .substring(4)\r\n          .replace(/МУУ|ХЭВИЙН БУС|ЭРГЭЛЗЭЭТЭЙ/g, \"ЧАНАРГҮЙ\");\r\n\r\n        let bname = \"\";\r\n        if (zoriulalt === \"06\") bname = \"Үл хөдлөх хөрөнгө\";\r\n        else if (segCode === \"81\" && zoriulalt === \"21\") bname = \"Хэрэглээний зээл\";\r\n        else if (segCode === \"81\" && zoriulalt === \"18\") bname = \"Бусад\";\r\n        else bname = row[headers[\"БҮТЭЭГДЭХҮҮНИЙ НЭР\"]];\r\n\r\n        let rawDate = row[headers[\"ДУУСАХ ОГНОО\"]];\r\n        let duusahOgnoo = isNaN(rawDate) ? new Date(Date.parse(rawDate)) : excelDateToJSDate(rawDate);\r\n\r\n        const dayDiff = (duusahOgnoo - dateFromCell) / (1000 * 60 * 60 * 24);\r\n        const interval = getTermInterval(dayDiff);\r\n\r\n        segData.push([segCode]);\r\n        angilalData.push([angilal]);\r\n        buteeData.push([bname]);\r\n        intervalData.push([interval]);\r\n      }\r\n\r\n      // Нэг дор бичих\r\n      sheet.getRangeByIndexes(5, headers[\"SEGMENT1\"], rows.length, 1).values = segData;\r\n      sheet.getRangeByIndexes(5, headers[\"ANGILAL1\"], rows.length, 1).values = angilalData;\r\n      sheet.getRangeByIndexes(5, headers[\"BUTEEGDEHUUN1\"], rows.length, 1).values = buteeData;\r\n      sheet.getRangeByIndexes(5, headers[\"HUGATSAANII INTERVAL\"], rows.length, 1).values = intervalData;\r\n\r\n      await context.sync();\r\n\r\n      // Тохиргоотой тооцоололууд\r\n      await calc1(sheet, headers);\r\n      await calc2(sheet, headers);\r\n      await calc3(sheet, headers);\r\n      await calc4(sheet, headers);\r\n      await calc91(sheet, headers);\r\n      await calc1001(sheet, headers);\r\n\r\n      setMessage(\"✅ Loan report pre-calculation complete.\");\r\n    });\r\n  });\r\n}\r\n\r\nasync function calc1(sheet, headers) {\r\n  await performCalculation(sheet, headers, \"ЗОРИУЛАЛТ\");\r\n}\r\n\r\nasync function calc1001(sheet, headers) {\r\n  await performCalculation(sheet, headers, \"АНГИЛАЛ\");\r\n}\r\n\r\nasync function calc2(sheet, headers) {\r\n  await performCalculation(sheet, headers, \"BUTEEGDEHUUN1\");\r\n}\r\nasync function calc3(sheet, headers) {\r\n  await performCalculation(sheet, headers, \"СЕГМЕНТ\");\r\n}\r\nasync function calc4(sheet, headers) {\r\n  await performCalculation(sheet, headers, \"HUGATSAANII INTERVAL\");\r\n}\r\nasync function calc91(sheet, headers) {\r\n  await performCalculation(sheet, headers, \"МАШИН\", false);\r\n}\r\n\r\n\r\n//Зээлийн баланс тайлан тооцоололт\r\nasync function performCalculation(sheet, headers, keyField) {\r\n  const usedRange = sheet.getUsedRange();\r\n  usedRange.load(\"values\");\r\n  await sheet.context.sync();\r\n\r\n  const data = usedRange.values;\r\n  const zorValues = [\r\n    ...new Set(\r\n      data\r\n        .slice(5)\r\n        .map((row) => row[headers[keyField]])\r\n        .filter(Boolean)\r\n    ),\r\n  ];\r\n\r\n  const headerLabels = [\r\n    \"81\",\r\n    \"МӨНГӨН ДҮН\",\r\n    \"TOO\",\r\n    \"ХЭВИЙН\",\r\n    \"ХУГАЦАА ХЭТЭРСЭН\",\r\n    \"ЧАНАРГҮЙ\",\r\n    \"ДЭЭД ХҮҮ\",\r\n    \"ДООД ХҮҮ\",\r\n    \"<>81\",\r\n    \"МӨНГӨН ДҮН\",\r\n    \"TOO\",\r\n    \"ХЭВИЙН\",\r\n    \"ХУГАЦАА ХЭТЭРСЭН\",\r\n    \"ЧАНАРГҮЙ\",\r\n    \"ДЭЭД ХҮҮ\",\r\n    \"ДООД ХҮҮ\",\r\n  ];\r\n\r\n  const headerStartCol = 63; // BL = 63\r\n  headerLabels.forEach((label, idx) => (sheet.getCell(0, headerStartCol + idx).values = [[label]]));\r\n\r\n  const BB = await getLastRow(sheet, 63);\r\n\r\n  const calculate = (zor, seg, not = false) => {\r\n    const filtered = data.filter((row) => {\r\n      const segment = (row[headers[\"SEGMENT1\"]] || \"\").toString().trim();\r\n      const zorVal = row[headers[keyField]];\r\n      return zorVal === zor && (not ? segment !== seg : segment === seg);\r\n    });\r\n\r\n    const angilalSum = (val) =>\r\n      filtered\r\n        .filter((r) => (r[headers[\"ANGILAL1\"]] || \"\").toString().trim() === val)\r\n        .reduce((s, r) => s + (+r[headers[\"ҮНДСЭН ЗЭЭЛ\"]] || 0), 0);\r\n\r\n    const zeel = filtered.reduce((s, r) => s + (+r[headers[\"ҮНДСЭН ЗЭЭЛ\"]] || 0), 0);\r\n    const huu = filtered.map((r) => +r[headers[\"ХҮҮНИЙ ХУВЬ\"]]).filter((n) => !isNaN(n));\r\n    // const uniqueRDCount = new Set(filtered.map((r) => r[headers[\"РД\"]]).filter(Boolean)).size;\r\n    const uniqueRDCount = new Set(\r\n    filtered.map((r) => r[keyField === \"АНГИЛАЛ\" ? headers[\"ДАНСНЫ ДУГААР\"] : headers[\"РД\"]])\r\n             .filter(Boolean)\r\n  ).size;\r\n\r\n    return [\r\n      zeel ,\r\n      uniqueRDCount,\r\n      angilalSum(\"ХЭВИЙН\") ,\r\n      angilalSum(\"ХУГАЦАА ХЭТЭРСЭН\") ,\r\n      angilalSum(\"ЧАНАРГҮЙ\"),\r\n      huu.length ? Math.max(...huu) / 1200 : \"\",\r\n      huu.length ? Math.min(...huu) / 1200 : \"\",\r\n    ];\r\n  };\r\n\r\n  zorValues.forEach((zor, index) => {\r\n    const i = BB + index;\r\n    sheet.getCell(i, 63).values = [[zor]];\r\n    const values = [...calculate(zor, \"81\"), \"\", ...calculate(zor, \"81\", true)];\r\n    values.forEach((val, j) => (sheet.getCell(i, 64 + j).values = [[val]]));\r\n  });\r\n\r\n  await sheet.context.sync();\r\n}\r\n// Зээл олголтын тайлан тооцоололт\r\n\r\nexport async function processLoanPrepData(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    await Excel.run(async (context) => {\r\n      setMessage(\"⏳ Ажиллаж байна...\");\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n      await unmergeAllCells(sheet);\r\n\r\n      const a2Cell = sheet.getCell(1, 0); // A2\r\n      a2Cell.load(\"values\");\r\n      await context.sync();\r\n\r\n      const a2Value = a2Cell.values[0][0];\r\n      if (!a2Value || !a2Value.toString().includes(\"Олгосон зээлийн тайлан\")) {\r\n        throw new Error(\"⚠️ Энэ хуудас олгосон зээлийн тайлан биш байна.\");\r\n      }\r\n\r\n      const headerLabels = [\r\n        \"НЭР\",\r\n        \"РЕГИСТЕР\",\r\n        \"ЗЭЭЛ ОЛГОСОН ОГНОО\",\r\n        \"ЗЭЭЛ ТӨЛӨГДӨХ ОГНОО\",\r\n        \"ЗОРИУЛАЛТ\",\r\n        \"ТӨЛӨВ\",\r\n        \"ДАНС\",\r\n        \"ХҮҮ\",\r\n        \"ХУГАЦАА\",\r\n        \"ВАЛЮТ\",\r\n        \"0\",\r\n        \"ДҮН\",\r\n        \"BUTEEGDEHUUNII_NER\",\r\n        \"ОЛГОСОН ДҮН\",\r\n        \"0\",\r\n        \"0\",\r\n        \"ОЛГОСОН АЖИЛТАН\",\r\n        \"0\",\r\n        \"ХАРИУЦСАН АЖИЛТАН\",\r\n        \"BUTEEGDEHUUN1\",\r\n        \"JDH_DUN\",\r\n        \"HUGATSAANII INTERVAL\",\r\n        \"SEGMENT1\",\r\n      ];\r\n\r\n      for (let col = 2; col < headerLabels.length + 2; col++) {\r\n        sheet.getCell(4, col).values = [[headerLabels[col - 2]]];\r\n      }\r\n      await context.sync();\r\n\r\n      const headers = await getHeaderMap(sheet);\r\n      const usedRange = sheet.getUsedRange();\r\n      usedRange.load(\"values\");\r\n      await context.sync();\r\n\r\n      const data = usedRange.values;\r\n      const toogooIdx = headers[\"ОЛГОСОН ДҮН\"];\r\n      const dateIdx = headers[\"ЗЭЭЛ ОЛГОСОН ОГНОО\"];\r\n      const buteegdehuunIdx = headers[\"BUTEEGDEHUUN1\"];\r\n      const buteegdehuunnii1Idx = headers[\"BUTEEGDEHUUNII_NER\"];\r\n      const zoriulaltIdx = headers[\"ЗОРИУЛАЛТ\"];\r\n      const huuIdx = headers[\"ХҮҮ\"];\r\n      const regIdx = headers[\"РЕГИСТЕР\"];\r\n      const sarIdx = headers[\"ХУГАЦАА\"];\r\n\r\n      for (let i = 5; i < data.length; i++) {\r\n        const row = data[i];\r\n        const valT = row[buteegdehuunnii1Idx - 1];\r\n        const valUprev = data[i - 1]?.[buteegdehuunnii1Idx];\r\n        const valDprev = data[i - 1]?.[3];\r\n        row[buteegdehuunnii1Idx] =\r\n          valT === \"\" || valT === undefined ? \"\" : valUprev === \"\" || valUprev === undefined ? valDprev : valUprev;\r\n\r\n        const zeel = parseFloat(row[toogooIdx]) || 0;\r\n        const huu = parseFloat(row[huuIdx]) || 0;\r\n        row[headers[\"JDH_DUN\"]] = (zeel * huu) / 100;\r\n\r\n        const sar = parseFloat(row[sarIdx]);\r\n        if (!isNaN(sar)) {\r\n          row[headers[\"HUGATSAANII INTERVAL\"]] =\r\n            sar <= 1\r\n              ? \"1 сар хүртэл хугацаатай\"\r\n              : sar <= 3\r\n                ? \"1-3 сар хүртэл хугацаатай\"\r\n                : sar <= 6\r\n                  ? \"3-6 сар хүртэл хугацаатай\"\r\n                  : sar <= 12\r\n                    ? \"6-12 сар хүртэл хугацаатай\"\r\n                    : sar <= 30\r\n                      ? \"12-30 сар хүртэл хугацаатай\"\r\n                      : sar <= 60\r\n                        ? \"30-60 сар хүртэл хугацаатай\"\r\n                        : \"60-с дээш сар хүртэл хугацаатай\";\r\n        }\r\n\r\n        if (row[regIdx] && row[regIdx].toString().length === 10) {\r\n          row[headers[\"SEGMENT1\"]] = \"81\";\r\n        }\r\n\r\n        const zor = (row[zoriulaltIdx] || \"\").toString();\r\n        const seg = (row[headers[\"SEGMENT1\"]] || \"\").toString();\r\n        let baseName = (row[buteegdehuunnii1Idx] || \"\").toString();\r\n        baseName = baseName.includes(\"-\") ? baseName.split(\"-\")[1].trim() : baseName.trim();\r\n\r\n        if (zor.startsWith(\"06\")) row[buteegdehuunIdx] = \"ҮЛ ХӨДЛӨХ ХӨРӨНГӨ\";\r\n        else if (seg === \"81\" && zor.startsWith(\"21\")) row[buteegdehuunIdx] = \"ХЭРЭГЛЭЭНИЙ ЗЭЭЛ\";\r\n        else if (seg === \"81\" && zor.startsWith(\"18\")) row[buteegdehuunIdx] = \"БУСАД\";\r\n        else row[buteegdehuunIdx] = baseName;\r\n      }\r\n\r\n      for (let i = 5; i < data.length; i++) {\r\n        const row = data[i];\r\n        [\"BUTEEGDEHUUNII_NER\", \"BUTEEGDEHUUN1\", \"ЗОРИУЛАЛТ\", \"JDH_DUN\", \"HUGATSAANII INTERVAL\", \"SEGMENT1\"].forEach(\r\n          (key) => {\r\n            if (row[headers[key]]) {\r\n              sheet.getCell(i, headers[key]).values = [[row[headers[key]]]];\r\n            }\r\n          }\r\n        );\r\n      }\r\n\r\n      await calc6(sheet, headers);\r\n      await calc7(sheet, headers);\r\n      await calc8(sheet, headers);\r\n      await calc90(sheet, headers);\r\n    });\r\n\r\n    await hideEmptyColumns(setMessage); // 🟢 context-г давхар ашигладаг тул гадуур await хийх хэрэгтэй\r\n\r\n    setMessage(\"✅ BL1-ийг шалгах Зээл олголт complete.\");\r\n  });\r\n}\r\n\r\nasync function calc6(sheet, headers) {\r\n  await summarizeGrantData(sheet, headers, \"ЗОРИУЛАЛТ\", true);\r\n}\r\n\r\nasync function calc7(sheet, headers) {\r\n  await summarizeGrantData(sheet, headers, \"BUTEEGDEHUUN1\", true);\r\n}\r\n\r\nasync function calc8(sheet, headers) {\r\n  await summarizeGrantData(sheet, headers, \"HUGATSAANII INTERVAL\", false);\r\n}\r\n\r\nasync function calc90(sheet, headers) {\r\n  await summarizeGrantData(sheet, headers, \"МАШИН\", false);\r\n}\r\nasync function summarizeGrantData(sheet, headers, categoryField, useSegment = true) {\r\n  const usedRange = sheet.getUsedRange();\r\n  usedRange.load(\"values\");\r\n  await sheet.context.sync();\r\n\r\n  const data = usedRange.values;\r\n  const categoryValues = [\r\n    ...new Set(\r\n      data\r\n        .slice(5)\r\n        .map((row) => row[headers[categoryField]])\r\n        .filter(Boolean)\r\n    ),\r\n  ];\r\n\r\n  const headerLabels = [\r\n    \"81\",\r\n    \"МӨНГӨН ДҮН\",\r\n    \"TOO\",\r\n    \"ЖДХ\",\r\n    \"ДЭЭД ХҮҮ\",\r\n    \"ДООД ХҮҮ\",\r\n    \"<>81\",\r\n    \"МӨНГӨН ДҮН\",\r\n    \"TOO\",\r\n    \"ЖДХ\",\r\n    \"ДЭЭД ХҮҮ\",\r\n    \"ДООД ХҮҮ\",\r\n  ];\r\n\r\n  const headerStartCol = 63; // BL = 63\r\n  headerLabels.forEach((label, idx) => (sheet.getCell(0, headerStartCol + idx).values = [[label]]));\r\n\r\n  const startRow = await getLastRow(sheet, 63);\r\n\r\n  const calculateSegmentStats = (value, segmentCode, exclude = false) => {\r\n    const filtered = data.filter((row) => {\r\n      const category = row[headers[categoryField]];\r\n      if (!useSegment) return category === value;\r\n\r\n      const segment = (row[headers[\"SEGMENT1\"]] || \"\").toString().trim();\r\n      return category === value && (exclude ? segment !== segmentCode : segment === segmentCode);\r\n    });\r\n\r\n    const totalAmount = filtered.reduce((sum, row) => sum + (+row[headers[\"ОЛГОСОН ДҮН\"]] || 0), 0);\r\n    const totalInterest = filtered.reduce((sum, row) => sum + (+row[headers[\"JDH_DUN\"]] || 0), 0);\r\n    const interestRates = filtered.map((row) => +row[headers[\"ХҮҮ\"]]).filter((n) => !isNaN(n));\r\n    const uniqueRegisterCount = new Set(filtered.map((row) => row[headers[\"РЕГИСТЕР\"]]).filter(Boolean)).size;\r\n\r\n    return [\r\n      totalAmount,\r\n      uniqueRegisterCount,\r\n      totalAmount > 0 ? totalInterest / totalAmount / 12 : 0,\r\n      interestRates.length ? Math.max(...interestRates) / 1200 : \"\",\r\n      interestRates.length ? Math.min(...interestRates) / 1200 : \"\",\r\n    ];\r\n  };\r\n\r\n  categoryValues.forEach((value, index) => {\r\n    const currentRow = startRow + index;\r\n    sheet.getCell(currentRow, 63).values = [[value]];\r\n    const values = useSegment\r\n      ? [...calculateSegmentStats(value, \"81\"), \"\", ...calculateSegmentStats(value, \"81\", true)]\r\n      : [...calculateSegmentStats(value)];\r\n    values.forEach((val, colOffset) => (sheet.getCell(currentRow, 64 + colOffset).values = [[val]]));\r\n  });\r\n\r\n  await sheet.context.sync();\r\n}\r\n// Зээл төлөлтийн тайлан\r\nexport async function loanpaymentData(setMessage, setLoading) {\r\n  return withLoading(setLoading, setMessage, async () => {\r\n    await Excel.run(async (context) => {\r\n      setMessage(\"⏳ Ажиллаж байна...\");\r\n      const sheet = context.workbook.worksheets.getActiveWorksheet();\r\n\r\n      const a2Cell = sheet.getCell(0, 0); // A2\r\n      a2Cell.load(\"values\");\r\n      await context.sync();\r\n\r\n      const a2Value = a2Cell.values[0][0];\r\n      if (!a2Value || !a2Value.toString().includes(\"Гэгээн инвест\")) {\r\n        throw new Error(\"⚠️ Энэ хуудас төлөгдсөн зээлийн тайлан биш байна.\");\r\n      }\r\n\r\n      await unmergeAllCells(sheet); // Merge арилгах\r\n\r\n      const headerLabels = [\r\n        \"ДАНС\",\r\n        \"ЗЭЭЛДЭГЧ\",\r\n        \"ТӨЛӨГДСӨН ОГНОО\",\r\n        \"ВАЛЮТ\",\r\n        \"ҮНДСЭН ХҮҮ\",\r\n        \"ТОГУУЛИЙН ХҮҮ\",\r\n        \"УРЬДЧИЛЖ ТӨЛСӨН\",\r\n        \"ЗЭЭЛ\",\r\n        \"НИЙТ\",\r\n        \"ХАНШ\",\r\n        \"НИЙТ ДҮН\",\r\n        \"ЗАЛРУУЛГА ЗЭЭЛ\",\r\n        \"МАШИН\",\r\n        \"ХҮҮНИЙ ДҮН\",\r\n        \"1\",\r\n        \"АНГИЛАЛ\",\r\n        \"СЕГМЕНТ\",\r\n        \"ХАРИУЦАГЧ\",\r\n        \"ДАНСНЫ ТӨЛӨВ\",\r\n        \"ТЕЛЛЕР\",\r\n        \"BUTEEGDEHUUNII_NER\",\r\n        \"ЗОРИУЛАЛТ\",\r\n        \"ЗЭЭЛИЙН ХУГАЦАА\",\r\n        \"0\",\r\n        \"BUTEEGDEHUUN1\",\r\n        \"HUGATSAANII INTERVAL\",\r\n      ];\r\n\r\n      for (let col = 0; col < headerLabels.length; col++) {\r\n        sheet.getCell(4, col).values = [[headerLabels[col]]];\r\n      }\r\n      await context.sync();\r\n\r\n      const headers = await getHeaderMap(sheet);\r\n      const usedRange = sheet.getUsedRange();\r\n      usedRange.load(\"values\");\r\n      await context.sync();\r\n      const data = usedRange.values;\r\n\r\n      const buteegdehuunIdx = headers[\"BUTEEGDEHUUN1\"];\r\n      const buteegdehuunnii1Idx = headers[\"BUTEEGDEHUUNII_NER\"];\r\n      const zoriulaltIdx = headers[\"ЗОРИУЛАЛТ\"];\r\n      const regIdx = headers[\"РЕГИСТЕР\"];\r\n      const sarIdx = headers[\"ЗЭЭЛИЙН ХУГАЦАА\"];\r\n\r\n      for (let i = 5; i < data.length; i++) {\r\n        const row = data[i];\r\n\r\n        const valT = row[buteegdehuunnii1Idx - 1];\r\n        const valUprev = data[i - 1]?.[buteegdehuunnii1Idx];\r\n        const valDprev = data[i - 1]?.[1];\r\n        row[buteegdehuunnii1Idx] =\r\n          valT === \"\" || valT === undefined ? \"\" : valUprev === \"\" || valUprev === undefined ? valDprev : valUprev;\r\n\r\n        const sar = parseFloat(row[sarIdx]);\r\n        if (!isNaN(sar)) {\r\n          row[headers[\"HUGATSAANII INTERVAL\"]] =\r\n            sar <= 1\r\n              ? \"1 сар хүртэл хугацаатай\"\r\n              : sar <= 3\r\n                ? \"1-3 сар хүртэл хугацаатай\"\r\n                : sar <= 6\r\n                  ? \"3-6 сар хүртэл хугацаатай\"\r\n                  : sar <= 12\r\n                    ? \"6-12 сар хүртэл хугацаатай\"\r\n                    : sar <= 30\r\n                      ? \"12-30 сар хүртэл хугацаатай\"\r\n                      : sar <= 60\r\n                        ? \"30-60 сар хүртэл хугацаатай\"\r\n                        : \"60-с дээш сар хүртэл хугацаатай\";\r\n        }\r\n\r\n        const zor = (row[zoriulaltIdx] || \"\").toString();\r\n        const seg = (row[headers[\"СЕГМЕНТ\"]] || \"\").toString();\r\n        let baseName = (row[buteegdehuunnii1Idx] || \"\").toString();\r\n        baseName = baseName.includes(\"-\") ? baseName.split(\"-\")[1].trim() : baseName.trim();\r\n\r\n        if (zor.startsWith(\"06\")) row[buteegdehuunIdx] = \"ҮЛ ХӨДЛӨХ ХӨРӨНГӨ\";\r\n        else if (seg === \"81\" && zor.startsWith(\"21\")) row[buteegdehuunIdx] = \"ХЭРЭГЛЭЭНИЙ ЗЭЭЛ\";\r\n        else if (seg === \"81\" && zor.startsWith(\"18\")) row[buteegdehuunIdx] = \"БУСАД\";\r\n        else row[buteegdehuunIdx] = baseName;\r\n      }\r\n\r\n      for (let i = 5; i < data.length; i++) {\r\n        const row = data[i];\r\n        [\"BUTEEGDEHUUNII_NER\", \"BUTEEGDEHUUN1\", \"ЗОРИУЛАЛТ\", \"HUGATSAANII INTERVAL\", \"СЕГМЕНТ\"].forEach((key) => {\r\n          if (row[headers[key]]) {\r\n            sheet.getCell(i, headers[key]).values = [[row[headers[key]]]];\r\n          }\r\n        });\r\n      }\r\n\r\n      await calc11(sheet, headers);\r\n      await calc12(sheet, headers);\r\n      await calc13(sheet, headers);\r\n      await calc92(sheet, headers);\r\n\r\n      await hideEmptyColumns(setMessage);\r\n\r\n      setMessage(\"✅ BL1-ийг шалгах Зээл төлөлт complete.\");\r\n      console.log(\"✅ Import нэртэй Sheet-нд зээлийн үлдэгдэл болон хаагдсан зээлийн тайланг оруулаарай.\");\r\n    });\r\n  });\r\n}\r\n\r\nasync function calc11(sheet, headers) {\r\n  await summarizePaymentData(sheet, headers, \"ЗОРИУЛАЛТ\", true);\r\n}\r\n\r\nasync function calc12(sheet, headers) {\r\n  await summarizePaymentData(sheet, headers, \"BUTEEGDEHUUN1\", true);\r\n}\r\n\r\nasync function calc13(sheet, headers) {\r\n  await summarizePaymentData(sheet, headers, \"HUGATSAANII INTERVAL\", false);\r\n}\r\nasync function calc92(sheet, headers) {\r\n  await summarizePaymentData(sheet, headers, \"МАШИН\", true);\r\n}\r\nasync function summarizePaymentData(sheet, headers, categoryField, useSegment = true) {\r\n  const usedRange = sheet.getUsedRange();\r\n  usedRange.load(\"values\");\r\n  await sheet.context.sync();\r\n\r\n  const data = usedRange.values;\r\n  const categoryValues = [\r\n    ...new Set(\r\n      data\r\n        .slice(5)\r\n        .map((row) => row[headers[categoryField]])\r\n        .filter(Boolean)\r\n    ),\r\n  ];\r\n\r\n  const headerLabels = [\"81\", \"МӨНГӨН ДҮН\", \"TOO\", \"<>81\", \"МӨНГӨН ДҮН\", \"TOO\"];\r\n\r\n  const headerStartCol = 63; // BL = 63\r\n  headerLabels.forEach((label, idx) => (sheet.getCell(0, headerStartCol + idx).values = [[label]]));\r\n\r\n  const startRow = await getLastRow(sheet, 63);\r\n\r\n  const calculateSegmentStats = (value, segmentCode, exclude = false) => {\r\n    const filtered = data.filter((row) => {\r\n      const category = row[headers[categoryField]];\r\n      if (!useSegment) return category === value;\r\n\r\n      const segment = (row[headers[\"СЕГМЕНТ\"]] || \"\").toString().trim();\r\n      return category === value && (exclude ? segment !== segmentCode : segment === segmentCode);\r\n    });\r\n\r\n    const totalAmount = filtered.reduce((sum, row) => sum + (+row[headers[\"ЗЭЭЛ\"]] || 0), 0);\r\n    const uniqueRegisterCount = new Set(filtered.map((row) => row[headers[\"ДАНС\"]]).filter(Boolean)).size;\r\n\r\n    return [totalAmount, uniqueRegisterCount];\r\n  };\r\n\r\n  categoryValues.forEach((value, index) => {\r\n    const currentRow = startRow + index;\r\n    sheet.getCell(currentRow, 63).values = [[value]];\r\n    const values = useSegment\r\n      ? [...calculateSegmentStats(value, \"81\"), \"\", ...calculateSegmentStats(value, \"81\", true)]\r\n      : [...calculateSegmentStats(value)];\r\n    values.forEach((val, colOffset) => (sheet.getCell(currentRow, 64 + colOffset).values = [[val]]));\r\n  });\r\n\r\n  await sheet.context.sync();\r\n}\r\n//зээлийн зорилго, хугацааг импортын хуудаснаас идэвхтэй хуудас руу хуулж оруулах функц\r\nexport async function extractLoanPurposeAndTerm(setMessage) {\r\n  try {\r\n    await Excel.run(async (context) => {\r\n      const activeSheet = context.workbook.worksheets.getActiveWorksheet();\r\n      const importSheet = context.workbook.worksheets.getItemOrNullObject(\"Import\");\r\n      await context.sync();\r\n\r\n      if (importSheet.isNullObject) {\r\n        setMessage(\"❌ 'Import Sheet' нэртэй worksheet олдсонгүй.\");\r\n        return;\r\n      }\r\n      await copyTop9IfClosedLoan(importSheet, setMessage);\r\n      const importHeaders = await getHeaderMap(importSheet);\r\n      const activeHeaders = await getHeaderMap(activeSheet);\r\n\r\n      const importAccountIndex = importHeaders[\"ДАНСНЫ ДУГААР\"];\r\n      const purposeIndex = importHeaders[\"ЗОРИУЛАЛТ\"];\r\n      const termIndex = importHeaders[\"ЗЭЭЛИЙН ХУГАЦАА\"];\r\n      const activeAccountIndex = activeHeaders[\"ДАНС\"];\r\n      const activePurposeIndex = activeHeaders[\"ЗОРИУЛАЛТ\"];\r\n      const activeTermIndex = activeHeaders[\"ЗЭЭЛИЙН ХУГАЦАА\"];\r\n\r\n      if (\r\n        [importAccountIndex, purposeIndex, termIndex, activeAccountIndex, activePurposeIndex, activeTermIndex].includes(\r\n          undefined\r\n        )\r\n      ) {\r\n        setMessage(\"⚠️ Шаардлагатай баганууд олдсонгүй (ДАНСНЫ ДУГААР, ЗОРИУЛАЛТ, ЗЭЭЛИЙН ХУГАЦАА).\");\r\n        return;\r\n      }\r\n\r\n      const importRange = importSheet.getUsedRange();\r\n      importRange.load(\"rowCount, values\");\r\n      const activeRange = activeSheet.getUsedRange();\r\n      activeRange.load(\"rowCount, values\");\r\n      await context.sync();\r\n\r\n      const importData = importRange.values.slice(5);\r\n      const activeData = activeRange.values.slice(5);\r\n\r\n      const loanMap = new Map();\r\n      importData.forEach((row) => {\r\n        const acc = row[importAccountIndex];\r\n        if (acc) {\r\n          loanMap.set(acc.toString().trim(), {\r\n            purpose: row[purposeIndex],\r\n            term: row[termIndex],\r\n          });\r\n        }\r\n      });\r\n\r\n      let updatedCount = 0;\r\n      activeData.forEach((row, i) => {\r\n        const acc = row[activeAccountIndex];\r\n        if (acc && loanMap.has(acc.toString().trim())) {\r\n          const { purpose, term } = loanMap.get(acc.toString().trim());\r\n          activeSheet.getCell(i + 5, activePurposeIndex).values = [[purpose]];\r\n          activeSheet.getCell(i + 5, activeTermIndex).values = [[term]];\r\n          updatedCount++;\r\n        }\r\n      });\r\n\r\n      await context.sync();\r\n      setMessage(`✅ Амжилттай холбоод зорилго ба хугацааг ${updatedCount} мөр дээр орууллаа.`);\r\n    });\r\n  } catch (error) {\r\n    console.error(\"❌ Алдаа:\", error);\r\n    setMessage(\"❌ Алдаа гарлаа: \" + error.message);\r\n  }\r\n}\r\n// \"ХААГДСАН ЗЭЭЛИЙН МЭДЭЭ\" мөрийг шалгах функц\r\nasync function copyTop9IfClosedLoan(sheet, setMessage) {\r\n  const a4 = sheet.getCell(3, 0); // A4 = row 4, col 0\r\n  a4.load(\"values\");\r\n  await sheet.context.sync();\r\n\r\n  if (a4.values[0][0] === \"ХААГДСАН ЗЭЭЛИЙН МЭДЭЭ\") {\r\n    const sourceRange = sheet.getRange(\"A9:U9\");\r\n    sourceRange.load(\"values\");\r\n    await sheet.context.sync();\r\n\r\n    const values = sourceRange.values[0].map((v) => (typeof v === \"string\" ? v.toUpperCase() : v));\r\n    const target = sheet.getRangeByIndexes(4, 0, 1, values.length); // Row 5\r\n    target.values = [values];\r\n\r\n    // A5 дээр \"ДАНСНЫ ДУГААР\", U5 дээр \"ЗЭЭЛИЙН ХУГАЦАА\" бичих\r\n    sheet.getRange(\"A5\").values = [[\"ДАНСНЫ ДУГААР\"]];\r\n    sheet.getRange(\"V5\").values = [[\"ЗЭЭЛИЙН ХУГАЦАА\"]];\r\n\r\n    await sheet.context.sync();\r\n    setMessage(\r\n      \"ℹ️ 'ХААГДСАН ЗЭЭЛИЙН МЭДЭЭ' тул 9-р мөрийн утгуудыг томоор 5-р мөрөнд хуулж, A5 болон U5-г шинэчиллээ.\"\r\n    );\r\n  }\r\n}\r\n\r\n// Merge-ийг арилгах функц\r\nasync function unmergeAllCells(sheet) {\r\n  if (!sheet) throw new Error(\"❌ Sheet is undefined.\");\r\n\r\n  const usedRange = sheet.getUsedRange();\r\n  usedRange.load(\"address\");\r\n  await sheet.context.sync();\r\n\r\n  usedRange.unmerge();\r\n  await sheet.context.sync();\r\n}\r\n\r\n// толгойн мөрийг олох функц\r\nasync function getHeaderMap(sheet) {\r\n  const headerRow = sheet.getRange(\"A5:CO5\");\r\n  headerRow.load(\"values\");\r\n  await sheet.context.sync();\r\n\r\n  const headers = {};\r\n  headerRow.values[0].forEach((val, i) => {\r\n    if (val) headers[val.toString().trim()] = i;\r\n  });\r\n  return headers;\r\n}\r\n\r\n// Excel огноог JS огноо болгон хөрвүүлэх функц\r\nfunction excelDateToJSDate(serial) {\r\n  const utc_days = Math.floor(serial - 25569); // 25569 = Jan 1, 1970\r\n  const utc_value = utc_days * 86400; // seconds\r\n  return new Date(utc_value * 1000);\r\n}\r\n\r\n//сүүлийн мөрийг олох функц\r\nasync function getLastRow(sheet, columnIndex) {\r\n  const usedRange = sheet.getUsedRange();\r\n  usedRange.load(\"rowCount\");\r\n  await sheet.context.sync();\r\n\r\n  const colRange = sheet.getRangeByIndexes(0, columnIndex, usedRange.rowCount, 1);\r\n  colRange.load(\"values\");\r\n  await sheet.context.sync();\r\n\r\n  const colValues = colRange.values.map((row) => row[0]);\r\n  for (let i = colValues.length - 1; i >= 0; i--) {\r\n    if (colValues[i] !== null && colValues[i] !== \"\") {\r\n      return i + 1; // Excel uses 1-based row indexing\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { BASE_URL} from \"../../config\";\r\nconst CreateGL = ({ isOpen, onClose }) => {\r\n  const [dansniiNer, setDansniiNer] = useState(\"\");\r\n  const [edDugaar, setEdDugaar] = useState(\"\");\r\n  const [dansniiAngilal, setDansniiAngilal] = useState(\"\");\r\n  const [currency, setCurrency] = useState(\"MNT\");\r\n  const [categories, setCategories] = useState([]);\r\n  const [filteredAccounts, setFilteredAccounts] = useState([]);\r\n  const [currencies, setCurrencies] = useState([]);\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n useEffect(() => {\r\n  (async () => {\r\n    try {\r\n      const [catRes, curRes] = await Promise.all([\r\n        fetch(`${BASE_URL}/api/glcategory`),\r\n        fetch(`${BASE_URL}/api/currency`),\r\n      ]);\r\n\r\n      if (!catRes.ok || !curRes.ok) {\r\n        throw new Error(\"Серверээс амжилтгүй хариу ирлээ.\");\r\n      }\r\n\r\n      const [catData, curData] = await Promise.all([\r\n        catRes.json(),\r\n        curRes.json(),\r\n      ]);\r\n\r\n      setCategories(Array.isArray(catData) ? catData : []);\r\n      setCurrencies(Array.isArray(curData) ? curData : []);\r\n    } catch (err) {\r\n      console.error(\"Reference fetch error:\", err);\r\n      // showMessage?.(\"❌ Өгөгдөл татахад алдаа гарлаа\"); // Хэрвээ AppContext ашигладаг бол\r\n    }\r\n  })();\r\n}, []);\r\n\r\n// Ангилал өөрчлөгдөхөд ЕДД жагсаалтыг шүүх\r\nuseEffect(() => {\r\n  if (!dansniiAngilal) {\r\n    setFilteredAccounts([]);\r\n    setEdDugaar(\"\");\r\n    setDansniiNer(\"\");\r\n    return;\r\n  }\r\n\r\n  (async () => {\r\n    try {\r\n      const res = await fetch(`${BASE_URL}/api/glaccount`);\r\n      if (!res.ok) throw new Error(\"GLAccount татахад алдаа гарлаа.\");\r\n      const data = await res.json();\r\n\r\n      const filtered = (Array.isArray(data) ? data : []).filter(\r\n        (a) => a[\"Дансны ангилал\"] === dansniiAngilal\r\n      );\r\n\r\n      setFilteredAccounts(filtered);\r\n      setEdDugaar(\"\");\r\n      setDansniiNer(\"\");\r\n    } catch (err) {\r\n      console.error(\"GLAccount fetch error:\", err);\r\n      // showMessage?.(\"❌ ЕДД жагсаалт татахад алдаа гарлаа\");\r\n    }\r\n  })();\r\n}, [dansniiAngilal]);\r\n\r\nconst handleAccountChange = (e) => {\r\n  const selected = filteredAccounts.find(\r\n    (a) => a[\"Дансны дугаар\"] === e.target.value\r\n  );\r\n  if (selected) {\r\n    setEdDugaar(selected[\"Дансны дугаар\"]);\r\n    setDansniiNer(selected[\"Дансны нэр\"]);\r\n  } else {\r\n    setEdDugaar(\"\");\r\n    setDansniiNer(\"\");\r\n  }\r\n};\r\n\r\nconst handleCreate = () => {\r\n  setMessage(\"Данс амжилттай үүслээ!\");\r\n  setTimeout(() => setMessage(\"\"), 3000);\r\n  setDansniiAngilal(\"\");\r\n  setEdDugaar(\"\");\r\n  setDansniiNer(\"\");\r\n  setCurrency(\"MNT\");\r\n};\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div style={styles.overlay}>\r\n      <div style={styles.modal}>\r\n        <h2 style={styles.title}>Ерөнхий дэвтэр үүсгэх</h2>\r\n\r\n        {message && <div style={styles.successMessage}>{message}</div>}\r\n\r\n        <div style={styles.row}>\r\n          <label>Дансны ангилал</label>\r\n          <select\r\n            value={dansniiAngilal}\r\n            onChange={(e) => setDansniiAngilal(e.target.value)}\r\n            style={styles.input}\r\n          >\r\n            <option value=\"\">Ангилал сонгох</option>\r\n            {categories.map((category, index) => (\r\n              <option key={index} value={category.name}>\r\n                {category.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>ЕД дугаар</label>\r\n          <select\r\n            value={edDugaar}\r\n            onChange={handleAccountChange}\r\n            style={styles.input}\r\n            disabled={!dansniiAngilal}\r\n          >\r\n            <option value=\"\">Дансны дугаар сонгох</option>\r\n            {filteredAccounts.map((account, index) => (\r\n              <option key={index} value={account[\"Дансны дугаар\"]}>\r\n                {account[\"Дансны дугаар\"]}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Дансны нэр</label>\r\n          <input\r\n            type=\"text\"\r\n            value={dansniiNer}\r\n            onChange={(e) => setDansniiNer(e.target.value)}\r\n            style={styles.input}\r\n          />\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Валют</label>\r\n          <select\r\n            value={currency}\r\n            onChange={(e) => setCurrency(e.target.value)}\r\n            style={styles.input}\r\n          >\r\n            {currencies.map((currency, index) => (\r\n              <option key={index} value={currency.code}>\r\n                {currency.code}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div style={styles.buttonRow}>\r\n          <button style={styles.submitButton} onClick={handleCreate}>\r\n            Данс үүсгэх\r\n          </button>\r\n          <button style={styles.cancelButton} onClick={onClose}>\r\n            Болих\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst styles = {\r\n  overlay: {\r\n    position: \"fixed\",\r\n    top: 0,\r\n    left: 0,\r\n    width: \"100vw\",\r\n    height: \"100vh\",\r\n    background: \"rgba(0, 0, 0, 0.3)\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    zIndex: 1000,\r\n  },\r\n  modal: {\r\n    width: \"600px\",\r\n    maxHeight: \"90vh\",\r\n    overflowY: \"auto\",\r\n    background: \"#fff\",\r\n    padding: \"20px\",\r\n    borderRadius: \"5px\",\r\n    boxShadow: \"0px 4px 10px rgba(0, 0, 0, 0.1)\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  title: {\r\n    fontSize: \"18px\",\r\n    marginBottom: \"15px\",\r\n    borderBottom: \"1px solid #ddd\",\r\n    paddingBottom: \"10px\",\r\n  },\r\n  successMessage: {\r\n    backgroundColor: \"#e0ffe0\",\r\n    color: \"#2d862d\",\r\n    padding: \"8px\",\r\n    borderRadius: \"4px\",\r\n    marginBottom: \"10px\",\r\n    textAlign: \"center\",\r\n  },\r\n  row: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    marginBottom: \"10px\",\r\n  },\r\n  input: {\r\n    padding: \"8px\",\r\n    fontSize: \"14px\",\r\n    border: \"1px solid #ccc\",\r\n    borderRadius: \"4px\",\r\n    width: \"100%\",\r\n    boxSizing: \"border-box\",\r\n  },\r\n  buttonRow: {\r\n    display: \"flex\",\r\n    justifyContent: \"flex-end\",\r\n    gap: \"10px\",\r\n    marginTop: \"15px\",\r\n  },\r\n  submitButton: {\r\n    background: \"#7367f0\",\r\n    color: \"#fff\",\r\n    border: \"none\",\r\n    padding: \"10px 15px\",\r\n    cursor: \"pointer\",\r\n    borderRadius: \"4px\",\r\n  },\r\n  cancelButton: {\r\n    background: \"#ccc\",\r\n    border: \"none\",\r\n    padding: \"10px 15px\",\r\n    cursor: \"pointer\",\r\n    borderRadius: \"4px\",\r\n  },\r\n};\r\n\r\nexport default CreateGL;","import React, { useState, useEffect } from \"react\";\r\nimport { useAppContext } from \"./AppContext\";\r\nimport { BASE_URL } from \"../../config\";\r\n\r\n\r\nconst CreateAccount = ({ isOpen, onClose }) => {\r\n  const { showMessage, setLoading } = useAppContext(); // ✅ AppContext ашиглана\r\n  const [edd, setEdd] = useState(\"\");\r\n  const [dansniiNer, setDansniiNer] = useState(\"\");\r\n  const [currency, setCurrency] = useState(\"\");\r\n  const [salbar, setSalbar] = useState(\"\");\r\n  const [dansniiDugaar, setDansniiDugaar] = useState(\"\");\r\n\r\n  const [currencies, setCurrencies] = useState([]);\r\n  const [branches, setBranches] = useState([]);\r\n  const [glAccounts, setGlAccounts] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const [currencyRes, branchRes, glRes] = await Promise.all([\r\n          fetch(`${BASE_URL}/api/currency`),\r\n          fetch(`${BASE_URL}/api/branch`),\r\n          fetch(`${BASE_URL}/api/glaccount`),\r\n        ]);\r\n\r\n        setCurrencies(await currencyRes.json());\r\n        setBranches(await branchRes.json());\r\n        setGlAccounts(await glRes.json());\r\n      } catch (error) {\r\n        console.error(\"Өгөгдөл татахад алдаа гарлаа:\", error);\r\n        showMessage(\"❌ Өгөгдөл татахад алдаа гарлаа\");\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (edd && salbar) {\r\n      generateAccountNumber();\r\n    }\r\n\r\n    if (edd) {\r\n      const selectedAccount = glAccounts.find(\r\n        (account) => account[\"Дансны дугаар\"] === edd\r\n      );\r\n\r\n      if (selectedAccount) {\r\n        setDansniiNer(selectedAccount[\"Дансны нэр\"]);\r\n        setCurrency(selectedAccount[\"Валют\"]);\r\n      }\r\n    } else {\r\n      setDansniiNer(\"\");\r\n      setCurrency(\"\");\r\n    }\r\n  }, [edd, salbar, glAccounts]);\r\n\r\n  const padNumber = (number, length) => {\r\n    return number.toString().padStart(length, \"0\");\r\n  };\r\n\r\n  const generateAccountNumber = () => {\r\n    const selectedAccount = glAccounts.find(\r\n      (account) => account[\"Дансны дугаар\"] === edd\r\n    );\r\n\r\n    if (selectedAccount && salbar) {\r\n      const eddDugaar = selectedAccount[\"Дансны дугаар\"];\r\n      const salbarCode = salbar;\r\n      const tooluur = parseInt(selectedAccount[\"Тоолуур\"]) + 1;\r\n\r\n      const newAccountNumber = `${eddDugaar}${salbarCode}${padNumber(tooluur, 4)}`;\r\n\r\n      setDansniiDugaar(newAccountNumber);\r\n    }\r\n  };\r\n\r\n  const handleCreate = async () => {\r\n    if (!dansniiDugaar || !dansniiNer || !currency || !salbar || !edd) {\r\n      showMessage(\"⚠️ Бүх талбарыг бөглөнө үү\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const res = await fetch(`${BASE_URL}/api/account`);\r\n      const allAccounts = await res.json();\r\n      const duplicate = allAccounts.find((acc) => acc[\"Дансны дугаар\"] === dansniiDugaar);\r\n\r\n      if (duplicate) {\r\n        showMessage(\"⚠️ Ижил дансны дугаар аль хэдийн үүссэн байна\");\r\n        return;\r\n      }\r\n\r\n      const newAccount = {\r\n        id: (allAccounts.length + 1).toString(),\r\n        \"Дансны дугаар\": dansniiDugaar,\r\n        \"Дансны нэр\": dansniiNer,\r\n        \"Валют\": currency,\r\n        \"Салбар\": branches.find((b) => b.code === salbar)?.name || salbar,\r\n        \"Нээсэн огноо\": new Date().toLocaleString(\"en-GB\"),\r\n      };\r\n\r\n      const saveRes =  await fetch(`${BASE_URL}/api/account`,{\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(newAccount),\r\n      });\r\n\r\n      const saveResult = await saveRes.json();\r\n\r\n      if (!saveRes.ok) {\r\n        throw new Error(saveResult.message || \"Хадгалах үед алдаа гарлаа\");\r\n      }\r\n\r\n      const counterRes = await fetch(`${BASE_URL}/api/gl-tooluurchange`, {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ edd }),\r\n      });\r\n\r\n      const counterResult = await counterRes.json();\r\n\r\n      if (!counterRes.ok) {\r\n        throw new Error(counterResult.message || \"Тоолуур шинэчлэхэд алдаа гарлаа\");\r\n      }\r\n\r\n      showMessage(\"✅ Данс амжилттай үүслээ\");\r\n      setEdd(\"\");\r\n      setDansniiNer(\"\");\r\n      setCurrency(\"\");\r\n      setSalbar(\"\");\r\n      setDansniiDugaar(\"\");\r\n    } catch (err) {\r\n      console.error(\"Данс үүсгэхэд алдаа гарлаа:\", err);\r\n      showMessage(\"❌ \" + (err.message || \"Сервертэй холбогдоход алдаа гарлаа\"));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setEdd(\"\");\r\n    setDansniiNer(\"\");\r\n    setCurrency(\"\");\r\n    setSalbar(\"\");\r\n    setDansniiDugaar(\"\");\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div style={styles.overlay}>\r\n      <div style={styles.modal}>\r\n        <h2 style={styles.title}>Данс үүсгэх</h2>\r\n\r\n        <div style={styles.row}>\r\n          <label>ЕДД</label>\r\n          <select\r\n            value={edd}\r\n            onChange={(e) => setEdd(e.target.value)}\r\n            style={styles.input}\r\n          >\r\n            <option value=\"\">ЕДД сонгох</option>\r\n            {glAccounts.map((account, index) => (\r\n              <option key={index} value={account[\"Дансны дугаар\"]}>\r\n                {account[\"Дансны дугаар\"]} - {account[\"Дансны нэр\"]}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Салбар</label>\r\n          <select\r\n            value={salbar}\r\n            onChange={(e) => setSalbar(e.target.value)}\r\n            style={styles.input}\r\n          >\r\n            <option value=\"\">Салбар сонгох</option>\r\n            {branches.map((branch, index) => (\r\n              <option key={index} value={branch.code}>\r\n                {branch.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Дансны нэр</label>\r\n          <input\r\n            type=\"text\"\r\n            value={dansniiNer}\r\n            placeholder=\"Дансны нэрээ оруулна уу\"\r\n            onChange={(e) => setDansniiNer(e.target.value)}\r\n            style={styles.input}\r\n          />\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Дансны дугаар</label>\r\n          <input\r\n            type=\"text\"\r\n            value={dansniiDugaar}\r\n            readOnly\r\n            style={{ ...styles.input, background: \"#f9f9f9\" }}\r\n          />\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Валют</label>\r\n          <input\r\n            type=\"text\"\r\n            value={currency}\r\n            readOnly\r\n            style={{ ...styles.input, background: \"#f9f9f9\" }}\r\n          />\r\n        </div>\r\n\r\n        <div style={styles.buttonRow}>\r\n          <button style={styles.submitButton} onClick={handleCreate}>\r\n            Данс үүсгэх\r\n          </button>\r\n          <button style={styles.cancelButton} onClick={handleClose}>\r\n            Болих\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst styles = {\r\n  overlay: {\r\n    position: \"fixed\",\r\n    top: 0,\r\n    left: 0,\r\n    width: \"100vw\",\r\n    height: \"100vh\",\r\n    background: \"rgba(0, 0, 0, 0.3)\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    zIndex: 1000,\r\n  },\r\n  modal: {\r\n    width: \"600px\",\r\n    maxHeight: \"90vh\",\r\n    overflowY: \"auto\",\r\n    background: \"#fff\",\r\n    padding: \"20px\",\r\n    borderRadius: \"5px\",\r\n    boxShadow: \"0px 4px 10px rgba(0, 0, 0, 0.1)\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  title: {\r\n    fontSize: \"18px\",\r\n    marginBottom: \"15px\",\r\n    borderBottom: \"1px solid #ddd\",\r\n    paddingBottom: \"10px\",\r\n  },\r\n  row: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    marginBottom: \"10px\",\r\n  },\r\n  input: {\r\n    padding: \"8px\",\r\n    fontSize: \"14px\",\r\n    border: \"1px solid #ccc\",\r\n    borderRadius: \"4px\",\r\n    width: \"100%\",\r\n    boxSizing: \"border-box\",\r\n  },\r\n  buttonRow: {\r\n    display: \"flex\",\r\n    justifyContent: \"flex-end\",\r\n    gap: \"10px\",\r\n    marginTop: \"15px\",\r\n  },\r\n  submitButton: {\r\n    background: \"#7367f0\",\r\n    color: \"#fff\",\r\n    border: \"none\",\r\n    padding: \"10px 15px\",\r\n    cursor: \"pointer\",\r\n    borderRadius: \"4px\",\r\n  },\r\n  cancelButton: {\r\n    background: \"#ccc\",\r\n    border: \"none\",\r\n    padding: \"10px 15px\",\r\n    cursor: \"pointer\",\r\n    borderRadius: \"4px\",\r\n  },\r\n};\r\n\r\nexport default CreateAccount;\r\n","import React, { useState } from \"react\";\r\nimport { useAppContext } from \"./AppContext\";\r\nimport { BASE_URL } from \"../../config\";\r\nconst CustomerModal = ({ isOpen, onClose }) => {\r\n  const { showMessage, setLoading } = useAppContext(); // ✅ AppContext-оос авна\r\n  const [name, setName] = useState(\"\");\r\n  const [status, setStatus] = useState(\"Идэвхитэй\");\r\n\r\n  const handleCreate = async () => {\r\n    if (!name.trim()) {\r\n      showMessage(\"⚠️ Нэрийг оруулна уу\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const res = await fetch(`${BASE_URL}/api/customer`);\r\n      const allCustomers = await res.json();\r\n\r\n      const duplicate = allCustomers.find(\r\n        (cus) => cus[\"name\"].toLowerCase() === name.toLowerCase()\r\n      );\r\n\r\n      if (duplicate) {\r\n        showMessage(\"⚠️ Ижил нэртэй харилцагч аль хэдийн үүссэн байна\");\r\n        return;\r\n      }\r\n\r\n      const saveRes = await fetch(`${BASE_URL}/api/customer`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          name,\r\n          status,\r\n        }),\r\n      });\r\n\r\n      const result = await saveRes.json();\r\n\r\n      if (!saveRes.ok) {\r\n        throw new Error(result.message || \"Хадгалах үед алдаа гарлаа\");\r\n      }\r\n\r\n      showMessage(\"✅ Хэрэглэгч амжилттай нэмэгдлээ\");\r\n      setName(\"\");\r\n      setStatus(\"Идэвхитэй\");\r\n    } catch (err) {\r\n      console.error(\"Хэрэглэгч нэмэхэд алдаа:\", err);\r\n      showMessage(\"❌ \" + (err.message || \"Сервертэй холбогдоход алдаа гарлаа\"));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setName(\"\");\r\n    setStatus(\"Идэвхитэй\");\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div style={styles.overlay}>\r\n      <div style={styles.modal}>\r\n        <h2 style={styles.title}>Хэрэглэгч нэмэх</h2>\r\n\r\n        <div style={styles.row}>\r\n          <label>Нэр</label>\r\n          <input\r\n            type=\"text\"\r\n            value={name}\r\n            placeholder=\"Хэрэглэгчийн нэр оруулна уу\"\r\n            onChange={(e) => setName(e.target.value)}\r\n            style={styles.input}\r\n          />\r\n        </div>\r\n\r\n        <div style={styles.row}>\r\n          <label>Төлөв</label>\r\n          <select\r\n            value={status}\r\n            onChange={(e) => setStatus(e.target.value)}\r\n            style={styles.input}\r\n          >\r\n            <option value=\"Идэвхитэй\">Идэвхитэй</option>\r\n            <option value=\"Идэвхгүй\">Идэвхгүй</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div style={styles.buttonRow}>\r\n          <button style={styles.submitButton} onClick={handleCreate}>\r\n            Хадгалах\r\n          </button>\r\n          <button style={styles.cancelButton} onClick={handleClose}>\r\n            Болих\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst styles = {\r\n  overlay: {\r\n    position: \"fixed\",\r\n    top: 0,\r\n    left: 0,\r\n    width: \"100vw\",\r\n    height: \"100vh\",\r\n    background: \"rgba(0, 0, 0, 0.3)\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    zIndex: 1000,\r\n  },\r\n  modal: {\r\n    width: \"400px\",\r\n    background: \"#fff\",\r\n    padding: \"20px\",\r\n    borderRadius: \"5px\",\r\n    boxShadow: \"0px 4px 10px rgba(0, 0, 0, 0.1)\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  title: {\r\n    fontSize: \"18px\",\r\n    marginBottom: \"15px\",\r\n    borderBottom: \"1px solid #ddd\",\r\n    paddingBottom: \"10px\",\r\n  },\r\n  row: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    marginBottom: \"10px\",\r\n  },\r\n  input: {\r\n    padding: \"8px\",\r\n    fontSize: \"14px\",\r\n    border: \"1px solid #ccc\",\r\n    borderRadius: \"4px\",\r\n    width: \"100%\",\r\n    boxSizing: \"border-box\",\r\n  },\r\n  buttonRow: {\r\n    display: \"flex\",\r\n    justifyContent: \"flex-end\",\r\n    gap: \"10px\",\r\n    marginTop: \"15px\",\r\n  },\r\n  submitButton: {\r\n    background: \"#7367f0\",\r\n    color: \"#fff\",\r\n    border: \"none\",\r\n    padding: \"10px 15px\",\r\n    cursor: \"pointer\",\r\n    borderRadius: \"4px\",\r\n  },\r\n  cancelButton: {\r\n    background: \"#ccc\",\r\n    border: \"none\",\r\n    padding: \"10px 15px\",\r\n    cursor: \"pointer\",\r\n    borderRadius: \"4px\",\r\n  },\r\n};\r\n\r\nexport default CustomerModal;\r\n","import React, { useEffect, useState , useRef } from \"react\";\r\nimport {\r\n  Button,\r\n  Input,\r\n  Textarea,\r\n  Field,\r\n  makeStyles,\r\n  tokens,\r\n} from \"@fluentui/react-components\";\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    height: \"100vh\",\r\n    backgroundColor: tokens.colorNeutralBackground1,\r\n    padding: \"10px\",\r\n    overflow: \"hidden\",\r\n  },\r\n  header: {\r\n    flexShrink: 0,\r\n    paddingBottom: \"8px\",\r\n    borderBottom: `1px solid ${tokens.colorNeutralStroke1}`,\r\n    backgroundColor: tokens.colorNeutralBackground2,\r\n    zIndex: 1,\r\n  },\r\n  title: {\r\n    margin: 0,\r\n    fontSize: \"16px\",\r\n  },\r\n  controls: {\r\n    marginTop: \"6px\",\r\n    display: \"flex\",\r\n    gap: \"6px\",\r\n    alignItems: \"center\",\r\n    fontSize: \"11px\",\r\n  },\r\n  logs: {\r\n    flex: 1,\r\n    overflowY: \"auto\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    paddingTop: \"10px\",\r\n  },\r\n  logItem: {\r\n    fontFamily: \"monospace\",\r\n    fontSize: \"12px\",\r\n    whiteSpace: \"pre-wrap\",\r\n    wordBreak: \"break-word\",\r\n  },\r\n  messagePanel: {\r\n    flex: 1,\r\n    marginTop: \"10px\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  textarea: {\r\n    height: \"40vh\",\r\n    width: \"100%\",\r\n  },\r\n});\r\n\r\nconst setupRuntimeLogger = (setLogList) => {\r\n  const originalLog = console.log;\r\n  const originalError = console.error;\r\n\r\n  const addLog = (type, ...args) => {\r\n    const entry = {\r\n      time: new Date(),\r\n      type,\r\n      message: args.map((a) => (typeof a === \"object\" ? JSON.stringify(a) : a)).join(\" \"),\r\n    };\r\n    //setLogList((prev) => [...prev, entry]);\r\n    //setLogList((prev) => [...prev, entry]); // ❌ сүүлд нэмэгдсэн лог доор гардаг\r\nsetLogList((prev) => [entry, ...prev]); // ✅ дээр талд нэмэгдэнэ\r\n\r\n  };\r\n\r\n  console.log = (...args) => {\r\n    addLog(\"log\", ...args);\r\n    originalLog(...args);\r\n  };\r\n\r\n  console.error = (...args) => {\r\n    addLog(\"error\", ...args);\r\n    originalError(...args);\r\n  };\r\n};\r\n\r\nconst LogPanelFluent = () => {\r\n  const styles = useStyles();\r\n  const [logs, setLogs] = useState([]);\r\n  const [note, setNote] = useState(\"\");\r\n  const [search, setSearch] = useState(\"\");\r\n  const logContainerRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    setupRuntimeLogger(setLogs);\r\n  }, []);\r\n\r\n   // 🔸 2. scroll-г дээд тал руу автоматаар хийх useEffect\r\n  useEffect(() => {\r\n    if (logContainerRef.current) {\r\n      logContainerRef.current.scrollTop = 0;\r\n    }\r\n  }, [logs]);\r\n\r\n  const filteredLogs = logs.filter((log) =>\r\n    log.message.toLowerCase().includes(search.toLowerCase())\r\n  );\r\n\r\n  const exportLogs = () => {\r\n    const blob = new Blob(\r\n      [\r\n        filteredLogs.map((log) => `[${log.time.toLocaleTimeString()}] ${log.message}`).join(\"\\n\"),\r\n      ],\r\n      { type: \"text/plain;charset=utf-8\" }\r\n    );\r\n\r\n    const link = document.createElement(\"a\");\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = \"logs.txt\";\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <div className={styles.header}>\r\n        <h3 className={styles.title}>📋 Үйлдлийн лог</h3>\r\n        <div className={styles.controls}>\r\n          <Input\r\n            size=\"small\"\r\n            value={search}\r\n            placeholder=\"Хайх...\"\r\n            onChange={(e, data) => setSearch(data.value)}\r\n            style={{ flex: 1 }}\r\n          />\r\n          <Button   size=\"small\" onClick={exportLogs}>📤</Button>\r\n        </div>\r\n      </div>\r\n\r\n     <div className={styles.logs} ref={logContainerRef}>\r\n        {filteredLogs.length === 0 && <p style={{ color: \"#888\" }}>🕒 Хайлтанд тохирсон лог олдсонгүй.</p>}\r\n        {filteredLogs.map((log, i) => (\r\n          <div\r\n            key={i}\r\n            className={styles.logItem}\r\n            style={{ color: log.type === \"error\" ? \"#cc0000\" : \"#333\" }}\r\n          >\r\n            [{log.time.toLocaleTimeString()}] {log.message}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <div className={styles.messagePanel}>\r\n        <Field size=\"large\"label=\"📝 Message Panel\">\r\n          <Textarea\r\n            size=\"large\"\r\n            className={styles.textarea}\r\n            value={note}\r\n            onChange={(e, data) => setNote(data.value)}\r\n          />\r\n        </Field>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LogPanelFluent;\r\n","import * as React from \"react\";\r\nimport { Calendar } from \"@fluentui/react-calendar-compat\";\r\nimport { setActiveCellValue2 } from \"../xFinance\";\r\nimport { useAppContext } from \"./AppContext\";\r\n//import Notification from \"./Notification\";\r\n\r\nconst addDays = (date, days) => {\r\n  const result = new Date(date);\r\n  result.setDate(result.getDate() + days);\r\n  return result;\r\n};\r\n\r\nconst addMonths = (date, months) => {\r\n  const result = new Date(date);\r\n  result.setMonth(result.getMonth() + months);\r\n  return result;\r\n};\r\n\r\nconst addYears = (date, years) => {\r\n  const result = new Date(date);\r\n  result.setFullYear(result.getFullYear() + years);\r\n  return result;\r\n};\r\n\r\nconst CalendarDateBoundaries = () => {\r\n  const today = new Date();\r\n  const minDate = addMonths(today, -1);\r\n  const maxDate = addYears(today, 1);\r\n  const restrictedDates = [\r\n    addDays(today, -2),\r\n    addDays(today, -8),\r\n    addDays(today, 2),\r\n    addDays(today, 8),\r\n  ];\r\n\r\n const [selectedDate, setSelectedDate] = React.useState(new Date()); // always defined\r\n  const { setLoading, showMessage } = useAppContext();\r\n\r\n  const onSelectDate = React.useCallback(async (date) => {\r\n    setSelectedDate(date);\r\n\r\n    if (!(date instanceof Date) || isNaN(date.getTime())) {\r\n      showMessage(\"❌ Огноо буруу байна.\");\r\n      return;\r\n    }\r\n\r\n    const formatted = date.toLocaleDateString(\"en-CA\");\r\n    await setActiveCellValue2(formatted, showMessage, setLoading);\r\n  }, [setLoading, showMessage]);\r\n\r\n  return (\r\n    <div style={{ padding: \"20px\" }}>\r\n      <Calendar\r\n        highlightSelectedMonth\r\n        //showGoToToday={false}\r\n        //minDate={minDate}\r\n        //maxDate={maxDate}\r\n        //restrictedDates={restrictedDates}\r\n        onSelectDate={onSelectDate}\r\n        value={selectedDate || undefined}\r\n      />\r\n\r\n \r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CalendarDateBoundaries;\r\n","import * as React from \"react\";\r\nconst ExcelIcon = (props) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width={60} height={60} viewBox=\"0 0 30 30\" {...props}>\r\n    <path d=\"M15 3a2 2 0 0 0-.4.043l-.002-.002-9.97 1.994-.001.002A2 2 0 0 0 3 7v16a2 2 0 0 0 1.629 1.965l9.969 1.994A2 2 0 0 0 15 27a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm4 2v3h2v2h-2v2h2v2h-2v2h2v2h-2v2h2v2h-2v3h6a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-6zm4 3h1a1 1 0 0 1 0 2h-1V8zM6.186 10h2.402l1.244 2.99c.101.244.182.527.26.848h.033c.045-.193.134-.486.27-.871L11.785 10h2.188l-2.614 4.955 2.692 5.043h-2.334l-1.504-3.258c-.057-.115-.124-.347-.18-.668h-.021a7.783 7.783 0 0 1-.203.696L8.295 20H5.949l2.783-5.006L6.186 10zM23 12h1a1 1 0 0 1 0 2h-1v-2zm0 4h1a1 1 0 0 1 0 2h-1v-2zm0 4h1a1 1 0 0 1 0 2h-1v-2z\" />\r\n  </svg>\r\n);\r\n\r\nconst KhanbankIcon = (props) => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    width={500}\r\n    height={476}\r\n    viewBox=\"0 0 375 357\"\r\n    {...props}\r\n  >\r\n    <path d=\"M104 .6C88.6 3 80.1 5.5 68.5 11.3c-19.3 9.6-35.6 25.9-45.2 45.2-8.1 16.2-10.8 28.1-10.7 47 .2 17.3 2.9 29 10.3 44 4.7 9.4 12.4 20.8 16.8 24.8 2 1.7 2 1.6 2.6-7.7.6-9.5 3.3-24.5 4.6-25.8.3-.4 9 7.6 19.1 17.7L84.5 175 66 193.5c-10.1 10.1-18.7 18.1-19.1 17.7-1.3-1.3-3.9-16.1-4.5-25.8l-.7-9.5-2.9 2.8c-8.2 7.9-17.9 25.5-22.4 40.8-3.2 11.2-4.4 31.2-2.4 43.2 10.9 68.6 85 106.3 147.4 75.2 7.7-3.9 19.5-11.9 22.9-15.7 1.7-1.9 1.5-1.9-6.5-2.6-9.4-.7-25.9-3.5-27-4.5-.4-.4 7.6-9 17.7-19.1l18.5-18.5 11.2 11.2c6.2 6.1 14.7 14.3 18.8 18.1 4.9 4.6 7.2 7.4 6.5 8-1.3 1.3-16.8 4-27.5 4.8l-8.4.7 5.4 4.8c2.9 2.6 8.8 6.8 13 9.4 51.9 31.3 118.2 12.1 145.2-42 7.5-15 10.3-27.4 10.2-46 0-15.8-2-25.6-7.9-39.7-3.8-8.8-12.6-22.7-17.8-27.6l-3.4-3.3-.6 9.4c-.6 9.6-3.3 24.6-4.6 25.9-.3.4-9-7.6-19.1-17.7L289.5 175l18.5-18.5c10.2-10.2 18.8-18.5 19.1-18.5 1.1 0 4 17.3 4.6 27.2l.6 8.9 2.4-2.3c4.3-4 11.9-15 15.8-22.8 15.2-30.3 15.1-63.1-.1-93.5-6.6-13.2-20.3-28.9-32.8-37.4C291.5.1 256.1-4.6 226 5.8c-12.3 4.3-29.2 14.4-35.8 21.5l-2.3 2.4 8.9.6c9.9.6 27.2 3.5 27.2 4.6 0 .3-8.3 8.9-18.5 19.1L187 72.5 168.5 54C158.3 43.8 150 35.3 150 34.9c0-1 17.6-4 27.1-4.6l9-.6-2.8-3c-7.1-7.4-22.6-16.5-36.3-21.2-12.4-4.3-32.2-6.5-43-4.9zm96.2 105.1c6.8 3 13.9 10.2 17.1 17.1 1.7 3.7 2.2 6.6 2.2 13.7 0 8-.3 9.7-3 14.8-5.2 10.4-17.3 18.7-27.3 18.7-23 0-41.3 14.7-45.3 36.3-1.5 8-.2 17.1 3.5 25.2l2.5 5.6-3.1-1.8c-5.5-3.2-17.3-15.6-21.6-22.8-7-11.9-9.4-20.1-9.9-34.5-.6-15 .9-22.6 6.7-34.5 10.8-22.3 31.5-37.1 56.2-40.5 8.6-1.1 15.2-.3 22 2.7zm37.9 18.3c7.1 7.1 9.3 10.1 13.2 18 2.5 5.2 5.3 12.4 6.2 16 2 8.7 1.9 25.6-.1 33.9-8.1 32.9-38.6 56.4-71.3 54.9-15.1-.7-24.3-6.3-30.3-18.6-2.9-5.9-3.3-7.6-3.3-15.2 0-7.3.4-9.3 2.8-14.2 3.5-7.1 11.9-15 18.4-17.3 2.6-.9 9-2 14.1-2.5 21.1-1.9 36.7-15.7 40.4-35.8 1.5-8 .1-16.7-3.8-24.9-1.5-3.2-3-6.2-3.2-6.7-1.4-2.9 9.6 5.2 16.9 12.4z\" />\r\n    <path d=\"M182.4 128c-4.7 1.9-6.8 8.5-4.3 13.2.6 1.1 2.6 2.6 4.5 3.4 8.8 3.7 16.5-6.9 10.2-14-2.5-2.9-7.2-4-10.4-2.6zM179.9 206.9c-3.8 3.9-4 8.8-.3 12.5 5.7 5.7 15.4 1.8 15.4-6.1 0-4.6-4.6-9.3-9-9.3-2.2 0-4.1.9-6.1 2.9z\" />\r\n  </svg>\r\n)\r\n\r\n\r\nexport { ExcelIcon, KhanbankIcon };\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { Input, Checkbox } from \"@fluentui/react-components\";\r\nimport {\r\n  Search16Regular,\r\n  ArrowSortUp16Regular,\r\n  ArrowSortDown16Regular,\r\n} from \"@fluentui/react-icons\";\r\nimport { getActiveCellFormula, setActiveCellValue } from \"../xFinance\";\r\nimport { loadSettings, getSettingValue } from \"../apiHelpers\";\r\nimport { useAppContext } from \"./AppContext\";\r\n\r\nconst SearchTableSheet = ({ isOpen, onClose }) => {\r\n  const { setLoading, showMessage } = useAppContext();\r\n  const [searchText, setSearchText] = useState(\"\");\r\n  const [data, setData] = useState([]);\r\n  const [selectedRow, setSelectedRow] = useState(null);\r\n  const [previousValue, setPreviousValue] = useState(null);\r\n  const [hideSelected, setHideSelected] = useState(false);\r\n  const [lastKey, setLastKey] = useState(null);\r\n  const [sortConfig, setSortConfig] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) fetchDataFromSheet();\r\n  }, [isOpen]);\r\n\r\n  const fetchDataFromSheet = async () => {\r\n    try {\r\n      const settings = await loadSettings();\r\n      const sheetname = getSettingValue(settings, \"sheetname\");\r\n      if (!sheetname) throw new Error(\"⚠️ 'sheetname' тохиргоо олдсонгүй\");\r\n\r\n      await Excel.run(async (context) => {\r\n        const sheet = context.workbook.worksheets.getItem(sheetname);\r\n        const usedRange = sheet.getUsedRange();\r\n        usedRange.load(\"values\");\r\n        await context.sync();\r\n\r\n        const values = usedRange.values;\r\n        if (values.length < 2) throw new Error(\"⚠️ Sheet-д шаардлагатай мэдээлэл алга байна\");\r\n\r\n        const header = values[0];\r\n        const rows = values.slice(1);\r\n        const lastColKey = header[header.length - 1];\r\n        setLastKey(lastColKey);\r\n\r\n        const parsed = rows.map((row, i) => {\r\n          const item = {};\r\n          header.forEach((key, idx) => {\r\n            item[key] = formatCellValue(row[idx], key);\r\n          });\r\n          item.__index = i + 1;\r\n          item.__lastKey = lastColKey;\r\n          item.__lastValue = row[header.length - 1];\r\n          return item;\r\n        });\r\n        setData(parsed);\r\n      });\r\n    } catch (err) {\r\n      console.error(\"❌ Sheet-ээс уншихад алдаа:\", err);\r\n      showMessage(\"❌ \" + err.message);\r\n    }\r\n  };\r\n\r\n  const formatCellValue = (value, columnName = \"\") => {\r\n    const lowerCol = columnName.toLowerCase();\r\n    const isDateColumn = lowerCol.includes(\"огноо\") || lowerCol.includes(\"date\");\r\n\r\n    if (\r\n      isDateColumn &&\r\n      typeof value === \"number\" &&\r\n      Number.isInteger(value) &&\r\n      value >= 1 &&\r\n      value <= 60000\r\n    ) {\r\n      const excelEpoch = new Date(1899, 11, 30);\r\n      const dateObj = new Date(excelEpoch.getTime() + (value + 1) * 86400000);\r\n      return dateObj.toISOString().split(\"T\")[0];\r\n    }\r\n\r\n    if (typeof value === \"string\" && !/^\\d{4}-\\d{2}-\\d{2}$/.test(value)) {\r\n      return value;\r\n    }\r\n\r\n    const num = parseFloat(value);\r\n    if (!isNaN(num) && Number.isFinite(num) && value.toString().length <= 15) {\r\n      return new Intl.NumberFormat(\"en-US\", {\r\n        minimumFractionDigits: 2,\r\n        maximumFractionDigits: 2,\r\n      }).format(num);\r\n    }\r\n\r\n    return value;\r\n  };\r\n\r\n  const handleSort = (key) => {\r\n    setSortConfig((prev) => {\r\n      const existing = prev.find((item) => item.key === key);\r\n      if (existing) {\r\n        const direction = existing.direction === \"ascending\" ? \"descending\" : \"ascending\";\r\n        return prev.map((item) =>\r\n          item.key === key ? { ...item, direction } : item\r\n        );\r\n      } else {\r\n        return [...prev, { key, direction: \"ascending\" }];\r\n      }\r\n    });\r\n  };\r\n//\r\n\r\n\r\n  const handleRowClick = async (row) => {\r\n    try {\r\n      const formula = await getActiveCellFormula(showMessage, setLoading);\r\n      setPreviousValue(formula);\r\n      setSelectedRow(row);\r\n\r\n      const insertValue = row[0] || Object.values(row)[0];\r\n      await setActiveCellValue(insertValue, showMessage, setLoading);\r\n\r\n      const rowIndex = row.__index;\r\n      const lastKeyName = row.__lastKey || lastKey || \"Сонгосон эсэх\";\r\n\r\n      setData((prev) =>\r\n        prev.map((r) =>\r\n          r.__index === rowIndex ? { ...r, [lastKeyName]: \"✅ Сонгосон\", __lastValue: \"✅ Сонгосон\" } : r\r\n        )\r\n      );\r\n\r\n      await Excel.run(async (context) => {\r\n        const settings = await loadSettings();\r\n        const sheetname = getSettingValue(settings, \"sheetname\");\r\n        const sheet = context.workbook.worksheets.getItem(sheetname);\r\n        const usedRange = sheet.getUsedRange();\r\n        usedRange.load(\"values,columnCount\");\r\n        await context.sync();\r\n\r\n        let lastColIndex = usedRange.columnCount;\r\n        const headers = usedRange.values[0];\r\n        if (!headers.includes(\"Сонгосон эсэх\")) {\r\n          sheet.getCell(0, lastColIndex).values = [[\"Сонгосон эсэх\"]];\r\n          await context.sync();\r\n        } else {\r\n          lastColIndex = headers.indexOf(\"Сонгосон эсэх\");\r\n        }\r\n\r\n        sheet.getCell(rowIndex, lastColIndex).values = [[\"✅ Сонгосон\"]];\r\n        await context.sync();\r\n      });\r\n    } catch (error) {\r\n      showMessage(\"❌ Алдаа: \" + error.message);\r\n    }\r\n  };\r\n  // const handleRowClick = async (row) => {\r\n  //   try {\r\n  //     const formula = await getActiveCellFormula(showMessage, setLoading);\r\n  //     setPreviousValue(formula);\r\n  //     setSelectedRow(row);\r\n\r\n  //     const insertValue = row[0] || Object.values(row)[0];\r\n  //     await setActiveCellValue(insertValue, showMessage, setLoading);\r\n\r\n  //     const rowIndex = row.__index;\r\n  //     const lastKeyName = row.__lastKey || lastKey || \"Сонгосон эсэх\";\r\n\r\n  //     setData((prev) =>\r\n  //       prev.map((r) =>\r\n  //         r.__index === rowIndex\r\n  //           ? { ...r, [lastKeyName]: \"✅ Сонгосон\", __lastValue: \"✅ Сонгосон\" }\r\n  //           : r\r\n  //       )\r\n  //     );\r\n  //   } catch (error) {\r\n  //     showMessage(\"❌ Алдаа: \" + error.message);\r\n  //   }\r\n  // };\r\n\r\n  const handleUndo = async () => {\r\n    if (previousValue) {\r\n      await setActiveCellValue(previousValue, showMessage, setLoading);\r\n      setPreviousValue(null);\r\n      setSelectedRow(null);\r\n    }\r\n  };\r\n\r\n  const filteredData = data.filter((row) => {\r\n    const textMatch = Object.values(row).some((v) =>\r\n      v?.toString().toLowerCase().includes(searchText.toLowerCase())\r\n    );\r\n    const hideMatch = hideSelected ? row.__lastValue !== \"✅ Сонгосон\" : true;\r\n    return textMatch && hideMatch;\r\n  });\r\n\r\n  // ⏹️ SORT CLEAR FUNCTION\r\nconst clearSort = () => {\r\n  setSortConfig([]);\r\n};\r\n\r\n// 🔽 SORTING LOGIC\r\nconst sortedData = [...filteredData].sort((a, b) => {\r\n  for (const { key, direction } of sortConfig) {\r\n    const aVal = a[key];\r\n    const bVal = b[key];\r\n\r\n    const aStr = aVal?.toString().trim();\r\n    const bStr = bVal?.toString().trim();\r\n\r\n    // ISO 8601 огноо эсвэл yyyy-mm-dd хэлбэр илэрхийлэх эсэх\r\n    const isDate = (v) => /^\\d{4}-\\d{2}-\\d{2}$/.test(v);\r\n    const aIsDate = isDate(aStr);\r\n    const bIsDate = isDate(bStr);\r\n\r\n    let result = 0;\r\n\r\n    if (aIsDate && bIsDate) {\r\n      result = new Date(aStr) - new Date(bStr);\r\n    } else {\r\n      const aNum = parseFloat(aStr.replace(/[, ]/g, \"\"));\r\n      const bNum = parseFloat(bStr.replace(/[, ]/g, \"\"));\r\n\r\n      const aIsNum = !isNaN(aNum) && isFinite(aNum);\r\n      const bIsNum = !isNaN(bNum) && isFinite(bNum);\r\n\r\n      if (aIsNum && bIsNum) {\r\n        result = aNum - bNum;\r\n      } else {\r\n        result = aStr.localeCompare(bStr, undefined, {\r\n          numeric: true,\r\n          sensitivity: \"base\",\r\n        });\r\n      }\r\n    }\r\n\r\n    if (result !== 0) return direction === \"ascending\" ? result : -result;\r\n  }\r\n  return 0;\r\n});\r\n\r\n\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div style={styles.overlay}>\r\n      <div style={styles.modal}>\r\n        <h2 style={styles.title}>📋Sheet-ээс хайх</h2>\r\n\r\n        <Input\r\n          appearance=\"outline\"\r\n          contentBefore={<Search16Regular />}\r\n          placeholder=\"Хайлт хийх...\"\r\n          value={searchText}\r\n          onChange={(_, d) => setSearchText(d.value)}\r\n          style={{ marginBottom: \"10px\" }}\r\n        />\r\n        <Checkbox\r\n          label=\"Сонгосон мөрийг Excel-ээс түр нуух\"\r\n          checked={hideSelected}\r\n          onChange={(_, data) => setHideSelected(data.checked)}\r\n          style={{ marginBottom: \"10px\" }}\r\n        />\r\n       <button onClick={clearSort}>Сорт арилгах</button>\r\n\r\n\r\n\r\n\r\n        {selectedRow && (\r\n          <div style={styles.selectedRow}>\r\n            <span>✅ Сонгогдсон: {JSON.stringify(selectedRow)}</span>\r\n            <button style={styles.undoButton} onClick={handleUndo}>Буцаах</button>\r\n          </div>\r\n        )}\r\n\r\n        <div style={styles.tableContainer}>\r\n          <table style={styles.table}>\r\n            <thead>\r\n              <tr>\r\n                {Object.keys(data[0] || {})\r\n                  .filter((k) => !k.startsWith(\"__\"))\r\n                  .map((key) => {\r\n                    const sortIndex = sortConfig.findIndex((c) => c.key === key);\r\n                    const sortItem = sortConfig[sortIndex];\r\n                    const sortIcon = sortItem\r\n                      ? sortItem.direction === \"ascending\"\r\n                        ? <ArrowSortUp16Regular />\r\n                        : <ArrowSortDown16Regular />\r\n                      : null;\r\n\r\n                    return (\r\n                      <th\r\n                        key={key}\r\n                        style={{ ...styles.th, cursor: \"pointer\" }}\r\n                        onClick={() => handleSort(key)}\r\n                      >\r\n                        <div style={{ display: \"flex\", alignItems: \"center\", gap: \"4px\" }}>\r\n                          <span>{key}</span>\r\n                          {sortIcon}\r\n                          {sortIndex >= 0 && (\r\n                            <span style={{ fontSize: \"10px\", opacity: 0.5 }}>({sortIndex + 1})</span>\r\n                          )}\r\n                        </div>\r\n                      </th>\r\n                    );\r\n                  })}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {sortedData.map((row, idx) => (\r\n                <tr key={idx} style={styles.tr} onDoubleClick={() => handleRowClick(row)}>\r\n                  {Object.entries(row)\r\n                    .filter(([k]) => !k.startsWith(\"__\"))\r\n                    .map(([k, val], i) => (\r\n                      <td key={i} style={styles.td}>{val}</td>\r\n                    ))}\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div style={{ marginTop: \"15px\", textAlign: \"right\" }}>\r\n          <button style={styles.closeButton} onClick={onClose}>Хаах</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst styles = {\r\n  overlay: {\r\n    position: \"fixed\", top: 0, left: 0, width: \"100vw\", height: \"100vh\",\r\n    background: \"rgba(0,0,0,0.3)\", display: \"flex\", justifyContent: \"center\", alignItems: \"center\", zIndex: 1000,\r\n  },\r\n  modal: {\r\n    width: \"90%\", maxWidth: \"1000px\", background: \"#fff\", padding: \"20px\", borderRadius: \"8px\",\r\n    maxHeight: \"90vh\", overflowY: \"auto\",\r\n  },\r\n  title: {\r\n    fontSize: \"14px\", marginBottom: \"10px\", borderBottom: \"1px solid #ddd\", paddingBottom: \"5px\",\r\n  },\r\n  tableContainer: {\r\n    border: \"1px solid #ccc\", borderRadius: \"4px\", maxHeight: \"70vh\", overflow: \"auto\",\r\n  },\r\n  table: {\r\n    width: \"100%\", borderCollapse: \"collapse\", tableLayout: \"auto\",\r\n  },\r\n  th: {\r\n    background: \"#f0f0f0\", padding: \"8px\", border: \"1px solid #ccc\", fontSize: \"12px\", position: \"sticky\", top: 0, zIndex: 1, whiteSpace: \"nowrap\",\r\n  },\r\n  td: {\r\n    padding: \"6px\", border: \"1px solid #eee\", fontSize: \"12px\", maxWidth: \"200px\", overflow: \"hidden\", textOverflow: \"ellipsis\", whiteSpace: \"nowrap\",\r\n  },\r\n  tr: {\r\n    cursor: \"pointer\", transition: \"background 0.2s\",\r\n  },\r\n  selectedRow: {\r\n    background: \"#e6f7ff\", padding: \"8px\", marginBottom: \"10px\", borderRadius: \"4px\", fontSize: \"8px\",\r\n  },\r\n  undoButton: {\r\n    background: \"#e74c3c\", color: \"#fff\", border: \"none\", padding: \"5px 10px\", marginLeft: \"10px\", cursor: \"pointer\", borderRadius: \"4px\",\r\n  },\r\n  closeButton: {\r\n    background: \"#ccc\", border: \"none\", padding: \"8px 15px\", cursor: \"pointer\", borderRadius: \"4px\",\r\n  },\r\n};\r\n\r\nexport default SearchTableSheet;\r\n","import React, { useRef, useState,useEffect  } from \"react\";\r\n\r\nimport { Button, Tooltip } from \"@fluentui/react-components\";\r\nimport * as fns from \"../xFinance\";\r\nimport * as bFns from \"../ebarimt\";\r\nimport * as efns from \"../externalAPI\";\r\nimport * as pfns from \"../polaris\";\r\nimport { withLoading } from \"../apiHelpers\";\r\nimport CreateGL from \"./CreateGL\";\r\nimport CreateAccount from \"./CreateAccount\";\r\nimport CustomerModal from \"./CustomerModal\";\r\nimport { useAppContext } from \"./AppContext\";\r\nimport LogPanel from \"./LogPanel\";\r\nimport {\r\n  NumberSymbol16Regular,\r\n  ArrowSort16Regular,\r\n  Filter16Regular,\r\n  Eraser24Regular,\r\n  Color16Regular,\r\n  ClipboardPaste16Regular,\r\n  CalendarLtr16Regular,\r\n  TargetArrow16Regular,\r\n  DataTrending16Regular,\r\n  VehicleCarProfileLtr16Regular,\r\n  MoneyHand16Regular,\r\n  Add16Regular,\r\n  AddCircle16Regular,\r\n  AddSquare16Regular,\r\n  Dismiss24Regular,\r\n  ReceiptSearchRegular,\r\n  DocumentTableSearchRegular,\r\n  TableCalculatorRegular,\r\n} from \"@fluentui/react-icons\";\r\nimport CalendarDateBoundaries from \"./CalendarDateBoundaries\";\r\nimport { ExcelIcon, KhanbankIcon } from \"../../icons\";\r\nimport SearchTableSheet from \"./SearchTableSheet\";\r\nimport PromptLikeInput from \"./PromptLikeInput\";\r\n\r\n\r\n\r\nconst groupedTools = [\r\n  {\r\n    title: \"Хөрвүүлэх хэрэгсэл\",\r\n    tools: [\r\n      { icon: <NumberSymbol16Regular />, label: \"Тоо руу хөрвүүлэх\" },\r\n      { icon: <NumberSymbol16Regular />, label: \"Текст рүү хөрвүүлэх\" },\r\n      { icon: <ArrowSort16Regular />, label: \"Хааны хуулга янзлах\" },\r\n      { icon: <ExcelIcon />, label: \"Сонгосон мужийг экпорт хийх\" },\r\n    ],\r\n  },\r\n  {\r\n    title: \"Туслах хэрэгсэл\",\r\n    tools: [\r\n      { icon: <Filter16Regular />, label: \"Идэвхитэй нүдээр шүүлт хийх\" },\r\n      { icon: <Eraser24Regular />, label: \"Шүүлт арилгах\" },\r\n      { icon: <Color16Regular />, label: \"Өнгөөр ялгах\" },\r\n      { icon: <ClipboardPaste16Regular />, label: \"Paste value\" },\r\n      { icon: <CalendarLtr16Regular />, label: \"Идэвхитэй нүдэнд огноо оруулах\" },\r\n      { icon: <CalendarLtr16Regular />, label: \"Date convert\" },\r\n      { icon: <TargetArrow16Regular />, label: \"Goal seek\" },\r\n      { icon: <TargetArrow16Regular />, label: \"Multi Goal seek\" },\r\n      { icon: <TableCalculatorRegular />, label: \"Динамик хүснэгт\" },\r\n    ],\r\n  },\r\n  {\r\n    title: \"API холболтууд\",\r\n    tools: [\r\n      { icon: <DataTrending16Regular />, label: \"Албан ханш татах\" },\r\n      { icon: <VehicleCarProfileLtr16Regular />, label: \"Машины мэдээлэл татах\" },\r\n      { icon: <MoneyHand16Regular />, label: \"Хааны token татах\" },\r\n      { icon: <KhanbankIcon />, label: \"Хааны хуулга татах\" },\r\n      { icon: <ReceiptSearchRegular />, label: \"Хааны данс лавлах\" },\r\n\r\n    ],\r\n  },\r\n   {\r\n    title: \"Ebarimt хэрэгслүүд\",\r\n    tools: [\r\n      { icon: <DocumentTableSearchRegular />, label: \"РД-аар ҮА лавлах\" },\r\n      \r\n    ],\r\n  },\r\n  {\r\n    title: \"Дансны удирдлага\",\r\n    tools: [\r\n      { icon: <Add16Regular />, label: \"ЕДД данс үүсгэх\" },\r\n      { icon: <AddCircle16Regular />, label: \"Данс үүсгэх\" },\r\n      { icon: <AddSquare16Regular />, label: \"Харилцагч үүсгэх\" },\r\n    ],\r\n  },\r\n  {\r\n    title: \"Поларис автоматжуулалт\",\r\n    tools: [\r\n      { icon: <Filter16Regular />, label: \"PS Зээлийн баланс\" },\r\n      { icon: <Filter16Regular />, label: \"PS Зээлийн олголт\" },\r\n      { icon: <Filter16Regular />, label: \"PS Зээлийн төлөлт\" },\r\n      { icon: <Filter16Regular />, label: \"PS Зээлийн зориулалт, хугацаа\" },\r\n      { icon: <Filter16Regular />, label: \"Өгөгдөл оруулах\" },\r\n      //{ icon: <Filter16Regular />, label: \"Өгөгдөл оруулах\" },\r\n    ],\r\n  },\r\n];\r\n\r\nconst CustomTools = ({ isSidebarOpen }) => {\r\n  const { setLoading, showMessage } = useAppContext();\r\n  const [openGL, setOpenGL] = useState(false);\r\n  const [openAccount, setOpenAccount] = useState(false);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [isCalendarOpen, setIsCalendarOpen] = useState(false);\r\n  const [isSearchTableSheet, setSearchTableSheet] = useState(false);\r\n  const [isPromptOpen, setPromptOpen] = useState(false);\r\n   const [isNarrowScreen, setIsNarrowScreen] = useState(false);\r\n  const fileInputRef = useRef(null);\r\nconst handleImportChange = async (e) => {\r\n  setSheetData(processedData);\r\nlastImportedData = processedData;\r\n  await pfns.writeFromImportedSameColumn( { setLoading, showMessage });\r\n};\r\n\r\n\r\n useEffect(() => {\r\n    const handleResize = () => {\r\n      setIsNarrowScreen(window.innerWidth < 500);\r\n    };\r\n    handleResize(); // Initial check\r\n    window.addEventListener(\"resize\", handleResize);\r\n    return () => window.removeEventListener(\"resize\", handleResize);\r\n  }, []);\r\n\r\n  const actions = {\r\n    \"Тоо руу хөрвүүлэх\": () => fns.handleNumberConversion(showMessage, setLoading),\r\n    \"Текст рүү хөрвүүлэх\": () => fns.handleTextConversion(showMessage, setLoading),\r\n    \"Динамик хүснэгт\": () => setSearchTableSheet(true),\r\n    \"Албан ханш татах\": () => efns.fetchCurrencyRatesByAPI(showMessage, setLoading),\r\n    \"Машины мэдээлэл татах\": () => efns.fetchVehicleInfoByPlate(showMessage, setLoading),\r\n    \"Хааны token татах\": () => efns.getKhanbankToken(showMessage, setLoading),\r\n    \"Хааны хуулга татах\": () => efns.fetchKhanbankReceiptFromSheet(showMessage, setLoading),\r\n    \"Хааны данс лавлах\": () => efns.fetchKhanbankAccountInfo(showMessage, setLoading),\r\n    \"РД-аар ҮА лавлах\": () => bFns.getMerchantCategoryById(showMessage, setLoading),\r\n    \"Идэвхитэй нүдээр шүүлт хийх\": () => fns.filterByActiveCellValue(showMessage, setLoading),\r\n    \"Шүүлт арилгах\": () => fns.clearAutoFilter(showMessage, setLoading),\r\n   // \"Өнгөөр ялгах\": () => fns.highlightCellsByColor(showMessage, setLoading),\r\n    //\"Paste value\": () => fns.pasteValuesOnly(showMessage, setLoading),\r\n    \"Сонгосон мужийг экпорт хийх\": () => fns.exportSelectedRangesToXLSX(showMessage, setLoading),\r\n    \"Идэвхитэй нүдэнд огноо оруулах\": () => setIsCalendarOpen(true),\r\n    \"PS Зээлийн баланс\": () => pfns.runLoanReportProcessor(showMessage, setLoading),\r\n    \"PS Зээлийн олголт\": () => pfns.processLoanPrepData(showMessage, setLoading),\r\n    \"PS Зээлийн төлөлт\": () => pfns.loanpaymentData(showMessage, setLoading),\r\n    \"PS Зээлийн зориулалт, хугацаа\": () => pfns.extractLoanPurposeAndTerm(showMessage, setLoading),\r\n    \"Өгөгдөл оруулах\": () => fileInputRef.current?.click(),\r\n\r\n\r\n    \"ЕДД данс үүсгэх\": () => setOpenGL(true),\r\n    \"Данс үүсгэх\": () => setOpenAccount(true),\r\n    \"Харилцагч үүсгэх\": () => setIsModalOpen(true),\r\n  };\r\n\r\nconst handleClick = async (label) => {\r\n  await withLoading(setLoading, showMessage, async () => {\r\n    await actions[label]?.();\r\n  });\r\n};\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: \"flex\",\r\n        flexDirection: isNarrowScreen ? \"column\" : \"row\",\r\n        alignItems: \"stretch\",\r\n        justifyContent: \"flex-start\",\r\n        minHeight: \"100vh\",\r\n        backgroundColor: \"#f3f4f6\",\r\n        padding: \"12px\",\r\n        width: isSidebarOpen ? \"calc(100% - 250px)\" : \"calc(85% - 50px)\",\r\n        marginLeft: isSidebarOpen ? \"250px\" : \"50px\",\r\n        transition: \"margin-left 0.3s ease-in-out, width 0.3s ease-in-out\",\r\n      }}\r\n    >\r\n     <div\r\n  style={{\r\n    backgroundColor: \"#fff\",\r\n    padding: \"10px\",\r\n    borderRadius: \"4px\",\r\n    boxShadow: \"0 2px 4px rgba(0, 0, 0, 0.1)\",\r\n    width: isNarrowScreen ? \"100%\" : \"400px\",\r\n    textAlign: \"center\",\r\n    borderRight: isNarrowScreen ? \"none\" : \"2px solid #ccc\",\r\n    minHeight: \"calc(100vh - 20px)\",\r\n    marginBottom: isNarrowScreen ? \"0\" : \"0\",\r\n    marginRight: isNarrowScreen ? \"0\" : \"20px\",\r\n    order: isNarrowScreen ? 2 : 0, // ⭐️ ЭНЭ ШИНЭ ЗУРААС!\r\n  }}\r\n>\r\n  <LogPanel />\r\n</div>\r\n\r\n\r\n      <div\r\n  style={{\r\n    backgroundColor: \"#e5e7eb\",\r\n    padding: \"20px\",\r\n    borderRadius: \"4px\",\r\n    minHeight: \"calc(100vh - 20px)\",\r\n    width: \"100%\",\r\n    maxWidth: isNarrowScreen ? \"100%\" : \"320px\",\r\n    boxShadow: \"0 2px 4px rgba(0, 0, 0, 0.1)\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    alignItems: \"center\",\r\n    order: isNarrowScreen ? 1 : 0, // ⭐️ ЭНЭ ШИНЭ ЗУРААС!\r\n  }}\r\n>\r\n\r\n        {groupedTools.map((group, groupIndex) => (\r\n          <div\r\n            key={groupIndex}\r\n            style={{\r\n              width: \"100%\",\r\n              backgroundColor: \"#fff\",\r\n              padding: \"6px\",\r\n              borderRadius: \"4px\",\r\n              boxShadow: \"0 2px 4px rgba(0, 0, 0, 0.1)\",\r\n              marginBottom: \"10px\",\r\n            }}\r\n          >\r\n            <h3\r\n              style={{\r\n                textAlign: \"left\",\r\n                padding: \"4px 0\",\r\n                fontSize: \"12px\",\r\n                fontWeight: \"bold\",\r\n                color: \"#333\",\r\n                marginBottom: \"4px\",\r\n                borderBottom: \"1px solid #ccc\",\r\n              }}\r\n            >\r\n              {group.title}\r\n            </h3>\r\n            <div\r\n              style={{\r\n                display: \"grid\",\r\n                gridTemplateColumns: \"repeat(6, 1fr)\",\r\n                gap: \"4px\",\r\n                padding: \"4px\",\r\n                textAlign: \"center\",\r\n              }}\r\n            >\r\n              {group.tools.map((tool, index) => (\r\n                <div key={index}>\r\n                  <Tooltip content={tool.label} relationship=\"label\">\r\n                    <Button\r\n                      icon={tool.icon}\r\n                      appearance=\"secondary\"\r\n                      onClick={() => handleClick(tool.label)}\r\n                      style={{ width: \"32px\", height: \"32px\" }}\r\n                    />\r\n                  </Tooltip>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n  <input\r\n  ref={fileInputRef}                      // ← Энэ дутуу байсан!\r\n  type=\"file\"\r\n  accept=\".xlsx,.xls\"\r\n  style={{ display: \"none\" }}\r\n  onChange={(e) => pfns.writeFromImportedSameColumn( { setLoading, showMessage })}\r\n/>\r\n\r\n\r\n      <CreateGL isOpen={openGL} onClose={() => setOpenGL(false)} />\r\n      <CreateAccount isOpen={openAccount} onClose={() => setOpenAccount(false)} />\r\n      <CustomerModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />\r\n      <SearchTableSheet isOpen={isSearchTableSheet} onClose={() => setSearchTableSheet(false)} />\r\n      {isCalendarOpen && (\r\n        <div\r\n          style={{\r\n            position: \"fixed\",\r\n            top: \"10%\",\r\n            left: \"50%\",\r\n            transform: \"translateX(-50%)\",\r\n            zIndex: 1000,\r\n            background: \"#fff\",\r\n            padding: \"20px\",\r\n            borderRadius: \"8px\",\r\n            boxShadow: \"0px 4px 10px rgba(0,0,0,0.2)\",\r\n          }}\r\n        >\r\n          <Button\r\n            icon={<Dismiss24Regular />}\r\n            appearance=\"subtle\"\r\n            onClick={() => setIsCalendarOpen(false)}\r\n            style={{ position: \"absolute\", top: \"8px\", right: \"8px\" }}\r\n            aria-label=\"Close\"\r\n          />\r\n          <CalendarDateBoundaries />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomTools;","import {withLoading} from \"./apiHelpers\";\r\nimport { BASE_URL } from \"../config\";\r\nexport async function getMerchantCategoryById(setMessage, setLoading) {\r\n  return await withLoading(setLoading, setMessage, async () => {\r\n    const id = await Excel.run(async (context) => {\r\n      const range = context.workbook.getActiveCell();\r\n      range.load(\"values\");\r\n      await context.sync();\r\n      const value = range.values[0][0];\r\n      if (!value || isNaN(value)) throw new Error(\"📌 ID тоо хэлбэртэй байх ёстой.\");\r\n      return value;\r\n    });\r\n\r\n    const url = `${BASE_URL}/api/merchant/${id}`;\r\n    \r\n\r\n    let response;\r\n    try {\r\n      response = await fetch(url);\r\n    } catch (error) {\r\n      throw new Error(\"❌ Сайт руу fetch хийхэд алдаа гарлаа: \" + error.message);\r\n    }\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`❌ HTTP алдаа: ${response.status}`);\r\n    }\r\n\r\n    const htmlText = await response.text();\r\n\r\n    if (typeof DOMParser === \"undefined\") {\r\n      throw new Error(\"❌ DOMParser дэмжигдэхгүй орчинд ажиллуулж байна.\");\r\n    }\r\n\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(htmlText, \"text/html\");\r\n    const table = doc.querySelector(\"table\");\r\n    const pageTitle = doc.querySelector(\"title\")?.textContent || \"Гарчиг олдсонгүй\";\r\n    if (!table) {\r\n      throw new Error(\"⚠️ Хүснэгт олдсонгүй.\");\r\n    }\r\n\r\n     let result = `${pageTitle}\\n`;\r\n    \r\n    const rows = table.querySelectorAll(\"tr\");\r\n\r\n    for (let i = 1; i < rows.length; i++) {\r\n      const cells = rows[i].querySelectorAll(\"td\");\r\n      const rowText = Array.from(cells)\r\n        .map((cell) => cell.textContent.trim())\r\n        .join(\" \");\r\n      result += rowText + \"\\n\";\r\n    }\r\n\r\n    // Excel дээр бичих\r\n    \r\n\r\n    setMessage(\"📋 Үр дүн:\\n\" + result);\r\n    //console.log(\"📋 Үр дүн:\", result);\r\n    return { result, response };\r\n  });\r\n}\r\n"],"names":["async","getKhanbankToken","setMessage","setLoading","withLoading","settings","loadSettings","username","getSettingValue","password","deviceToken","deviceId","accessId","getSettingId","refreshId","Error","myHeaders","Headers","append","body","JSON","stringify","grant_type","channelId","response","fetch","method","headers","redirect","result","json","ok","handleHttpError","BASE_URL","value","access_token","refresh_token","getTermInterval","daysOrMonths","days","Number","isNaN","performCalculation","sheet","keyField","usedRange","getUsedRange","load","context","sync","data","values","zorValues","Set","slice","map","row","filter","Boolean","forEach","label","idx","getCell","BB","getLastRow","calculate","zor","seg","not","filtered","segment","toString","trim","angilalSum","val","r","reduce","s","zeel","huu","n","size","length","Math","max","min","index","i","j","summarizeGrantData","categoryField","useSegment","categoryValues","startRow","calculateSegmentStats","segmentCode","exclude","category","totalAmount","sum","totalInterest","interestRates","currentRow","colOffset","summarizePaymentData","unmergeAllCells","unmerge","getHeaderMap","headerRow","getRange","excelDateToJSDate","serial","utc_days","floor","Date","columnIndex","colRange","getRangeByIndexes","rowCount","colValues","styles","overlay","position","top","left","width","height","background","display","justifyContent","alignItems","zIndex","modal","maxHeight","overflowY","padding","borderRadius","boxShadow","flexDirection","title","fontSize","marginBottom","borderBottom","paddingBottom","successMessage","backgroundColor","color","textAlign","input","border","boxSizing","buttonRow","gap","marginTop","submitButton","cursor","cancelButton","CreateGL","isOpen","onClose","dansniiNer","setDansniiNer","useState","edDugaar","setEdDugaar","dansniiAngilal","setDansniiAngilal","currency","setCurrency","categories","setCategories","filteredAccounts","setFilteredAccounts","currencies","setCurrencies","message","useEffect","catRes","curRes","Promise","all","catData","curData","Array","isArray","err","console","error","res","a","_jsx","style","children","_jsxs","onChange","e","target","name","selected","find","disabled","account","type","code","onClick","handleCreate","setTimeout","CreateAccount","showMessage","useAppContext","edd","setEdd","salbar","setSalbar","dansniiDugaar","setDansniiDugaar","branches","setBranches","glAccounts","setGlAccounts","currencyRes","branchRes","glRes","fetchData","generateAccountNumber","selectedAccount","newAccountNumber","number","parseInt","padStart","padNumber","branch","placeholder","readOnly","allAccounts","acc","newAccount","id","b","toLocaleString","saveRes","saveResult","counterRes","counterResult","handleClose","CustomerModal","setName","status","setStatus","cus","toLowerCase","useStyles","makeStyles","container","tokens","colorNeutralBackground1","overflow","header","flexShrink","colorNeutralStroke1","colorNeutralBackground2","margin","controls","logs","flex","paddingTop","logItem","fontFamily","whiteSpace","wordBreak","messagePanel","textarea","LogPanelFluent","setLogs","note","setNote","search","setSearch","logContainerRef","useRef","setLogList","originalLog","log","originalError","addLog","args","entry","time","join","prev","setupRuntimeLogger","current","scrollTop","filteredLogs","includes","className","Input","Button","exportLogs","blob","Blob","toLocaleTimeString","link","document","createElement","href","URL","createObjectURL","download","appendChild","click","removeChild","ref","Field","Textarea","addDays","date","setDate","getDate","CalendarDateBoundaries","today","selectedDate","setSelectedDate","addMonths","setMonth","getMonth","addYears","setFullYear","getFullYear","React","onSelectDate","getTime","formatted","toLocaleDateString","setActiveCellValue2","Calendar","highlightSelectedMonth","undefined","ExcelIcon","props","xmlns","viewBox","d","KhanbankIcon","maxWidth","tableContainer","table","borderCollapse","tableLayout","th","td","textOverflow","tr","transition","selectedRow","undoButton","marginLeft","closeButton","SearchTableSheet","searchText","setSearchText","setData","setSelectedRow","previousValue","setPreviousValue","hideSelected","setHideSelected","lastKey","setLastKey","sortConfig","setSortConfig","fetchDataFromSheet","sheetname","Excel","run","workbook","worksheets","getItem","rows","lastColKey","parsed","item","key","formatCellValue","__index","__lastKey","__lastValue","columnName","lowerCol","isInteger","excelEpoch","toISOString","split","test","num","parseFloat","isFinite","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","sortedData","textMatch","Object","some","v","hideMatch","sort","direction","aVal","bVal","aStr","bStr","isDate","aIsDate","bIsDate","aNum","replace","bNum","aIsNum","bIsNum","localeCompare","numeric","sensitivity","appearance","contentBefore","Search16Regular","_","Checkbox","checked","clearSort","setActiveCellValue","keys","k","startsWith","sortIndex","findIndex","c","sortItem","sortIcon","ArrowSortUp16Regular","ArrowSortDown16Regular","existing","handleSort","opacity","onDoubleClick","formula","getActiveCellFormula","insertValue","rowIndex","lastKeyName","lastColIndex","columnCount","indexOf","handleRowClick","entries","groupedTools","tools","icon","NumberSymbol16Regular","ArrowSort16Regular","Filter16Regular","Eraser24Regular","Color16Regular","ClipboardPaste16Regular","CalendarLtr16Regular","TargetArrow16Regular","TableCalculatorRegular","DataTrending16Regular","VehicleCarProfileLtr16Regular","MoneyHand16Regular","ReceiptSearchRegular","DocumentTableSearchRegular","Add16Regular","AddCircle16Regular","AddSquare16Regular","CustomTools","isSidebarOpen","openGL","setOpenGL","openAccount","setOpenAccount","isModalOpen","setIsModalOpen","isCalendarOpen","setIsCalendarOpen","isSearchTableSheet","setSearchTableSheet","isPromptOpen","setPromptOpen","isNarrowScreen","setIsNarrowScreen","fileInputRef","handleResize","window","innerWidth","addEventListener","removeEventListener","actions","Тоо руу хөрвүүлэх","fns","Текст рүү хөрвүүлэх","Динамик хүснэгт","Албан ханш татах","startDate","endDate","range","getActiveCell","getActiveWorksheet","startCell","col","dayItem","usdRate","jpyRate","rateDate","efns","Машины мэдээлэл татах","car_token","plateNo","fetchVehicleData","token","Authorization","plate_no","getCarToken","saveSetting","popupContent","part","Хааны token татах","Хааны хуулга татах","accountNo","fromDate","toDate","fromRaw","toRaw","normalizeExcelDate","url","transactions","tx","transactionDate","txnTime","txnBranchId","beginBalance","amount","Debit","amountType","codeDescription","Credit","endBalance","transactionRemarks","accountId","formatLargeNumber","Хааны данс лавлах","activeCellAddress","activeCell","address","isIban","apiPath","makeRequest","tokenResp","accountDetail","counterpartyName","getOffsetRange","РД-аар ҮА лавлах","htmlText","text","DOMParser","doc","parseFromString","querySelector","pageTitle","textContent","querySelectorAll","cells","from","cell","bFns","Идэвхитэй нүдээр шүүлт хийх","Шүүлт арилгах","Сонгосон мужийг экпорт хийх","Идэвхитэй нүдэнд огноо оруулах","PS Зээлийн баланс","c1Cell","c1Value","lastRow","headersArray","startCol","writeHeaders","b3Cell","dateFromCell","parse","substring","dataRange","segData","angilalData","buteeData","intervalData","segCode","zoriulalt","angilal","bname","rawDate","interval","push","calc1","calc2","calc3","calc4","calc91","calc1001","pfns","PS Зээлийн олголт","a2Cell","a2Value","headerLabels","toogooIdx","buteegdehuunIdx","buteegdehuunnii1Idx","zoriulaltIdx","huuIdx","regIdx","sarIdx","valT","valUprev","valDprev","sar","baseName","calc6","calc7","calc8","calc90","hideEmptyColumns","PS Зээлийн төлөлт","calc11","calc12","calc13","calc92","PS Зээлийн зориулалт, хугацаа","activeSheet","importSheet","getItemOrNullObject","isNullObject","a4","sourceRange","toUpperCase","copyTop9IfClosedLoan","importHeaders","activeHeaders","importAccountIndex","purposeIndex","termIndex","activeAccountIndex","activePurposeIndex","activeTermIndex","importRange","activeRange","importData","activeData","loanMap","Map","set","purpose","term","updatedCount","has","get","Өгөгдөл оруулах","ЕДД данс үүсгэх","Данс үүсгэх","Харилцагч үүсгэх","minHeight","borderRight","marginRight","order","LogPanel","group","groupIndex","fontWeight","gridTemplateColumns","tool","Tooltip","content","relationship","handleClick","accept","settingKey","caseSensitive","targetColNumber","targetColIndex","lastImportedData","wb","activeRow","activeCol","rawKey","keyCmp","matchRowIndex","valueToWrite","transform","Dismiss24Regular","right"],"sourceRoot":""}